---
title: "Job Application QJ45141"
author: "AH Uyekita"
date: "30 de setembro de 2018"
bibliography: bibliography.bib
output:
  html_document:
    theme: spacelab
    highlight: tango
    toc: true
    toc_float: true
    collapse: true
    smooth_scroll: true
    number_sections: false
---

<style>
body {
text-align: justify}
</style>

```{r setup-library, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Setup chunk necessary to set workplace, libraries, and functions.


# Set work directory
setwd("~")
setwd("~/Workplace")
Sys.setlocale("LC_ALL","English")

# Libraries
library(readxl)
library(dplyr)
library(datasets)
library(ggplot2)
library(ggrepel)
library(grid)
library(ggfortify)
library(ggthemes)
library(kableExtra)
library(rmdformats)
library(prettydoc)
library(leaflet)
library(geojsonio)
library(sp)
library(tidyr)
```


```{r importing,cache=TRUE,echo=FALSE,warning=FALSE,message=FALSE,include=FALSE}
# 4. Importing the database plainsheet from the Electricity Information Disclosure

       ## 4.1. Importing Dataset from ComCom archive 
#db_raw <- read_xlsx(path = "~/Workplace/04-Dataset/Electricity-distributors-information-disclosures-2013March-2018.xlsm", 
#                    sheet = "Database",   # Sheet to be imported
#                    col_names = TRUE)     # Keep theoriginal columns name

db_raw <- read_xlsx(path = "~/Workplace/04-Dataset/Electricity-distributors-information-disclosure-data-20132018-1-October-2018.xlsm", 
                    sheet = "Database",   # Sheet to be imported
                    col_names = TRUE)     # Keep theoriginal columns name

       ## 4.2 Renaming column to remove spaces
colnames(x = db_raw) <-     c("EDB",
                            "Network",
                            "Disclosure_year",
                            "Schedule",
                            "Schedule_reference",
                            "Section",
                            "Category",
                            "Subcategory",
                            "Description",
                            "Year",
                            "Forecast_year",
                            "Units",
                            "Value",
                            "Text_input")

       ## 4.3. Importing the Polygons of New Zealand Regions
nz_region <- geojsonio::geojson_read("~/Workplace/01-Maps/nz_region.geojson",
                                      what = "sp")

       ## 4.4. Importing the Polygons of New Zealand Territories
nz_territories <- geojsonio::geojson_read("~/Workplace/01-Maps/nz_territories.geojson",
                                      what = "sp")
```


```{r data-manipulation,echo=FALSE,include=FALSE,cache=TRUE}
# 5. Creating a Neaty Data ####

# Ordering the raw data
db_raw <- db_raw %>% arrange(-Year,EDB,Network)

# Removing the space between column names
db_raw$Network <- gsub(pattern = " ",
                       replacement = "",
                       x = db_raw$Network)

# Removing NA
for (i in 1:(ncol(db_raw)) )
       {
       # Temporaly variable
       teste <- db_raw[,i]
       
       # Replacing rows with NA by 0
       teste[is.na(teste),] <- 0
       
       # Updating the db_raw
       db_raw[,i] <- teste
              }

# Creating a new database with only EDB, Network, and Year.
# I used Section, Category, Subcategory, and Description to subset
# the unique pair EDB and Network.
db_neat <- db_raw %>% filter(Section %in% "9c: Overhead lines and underground cables",
                             Category %in% "Total overhead length",
                             Subcategory %in% "Circuit length (km)",
                             Description %in% "Total overhead length") %>%
                                   select(EDB,Network,Year)
```


```{r filling-data,echo=FALSE,include=FALSE,cache=TRUE}
# 6. Data Manipulation Explanation #########################################################

# I am going to fill the db_neat with data, each column is a new characteristc.
# For any kind of characteristc I will give prefixes in your variable, for instance:
#
#      PREFIXES                                  SUFIXES
#
#      Asset:        a                           Percentage: p
#      Reliability:  r
#      Economic:     e
#      Aurora:       au
#      All EDB:      edb
#      Table:        tb
#      Graphic:      gp
#
# List of variables:
#      r_i_un:       Interruptions Unplanned (Quantity)
#      r__ipl:       Interruptions Planned (Quantity)
#      r_i_tot:      Total interruptions
#      r_less_3:     Consumer restored in less than 3 hours
#      r_more_3:     Consumer restored in more than 3 hours
#      r_tp:         Transpower Interruptions
#      r_un_tp_saidi: Transpower SAIDI Unplanned
#      r_pl_tp_saidi: Transpower SAIDI Planned
#      r_un_tp_saifi: Transpower SAIFI Unplanned
#      r_pl_tp_saifi: Transpower SAIFI Planned
#      r_un_saidi:   Unplanned SAIDI
#      r_pl_saidi:   Planned SAIDI
#      r_saidi:      Total SAIDI
#      r_un_saifi:   Unplanned SAIFI
#      r_pl_saifi:   Planned SAIFI
#      r_saifi:      Total SAIFI
#      r_ae_saidi:   Adverse Enviroment cause of SAIDI
#      r_aw_saidi:   Adverse weather cause of SAIDI
#      r_idk_saidi:  Cause unknown cause of SAIDI
#      r_eqp_saidi:  Defective equipment cause of SAIDI
#      r_hum_saidi:  Human error cause of SAIDI
#      r_lig_saidi:  Lightning cause of SAIDI
#      r_tpi_saidi:  Third party interference  cause of SAIDI
#      r_veg_saidi:  Vegetation cause of SAIDI
#      r_wlf_saidi:  Wildlife cause of SAIDI
#      r_ae_saifi:   Adverse environment cause of SAIFI
#      r_aw_saifi:   Adverse weather cause of SAIFI
#      r_idk_saifi:  Cause unknown cause of SAIFI
#      r_eqp_saifi:  Defective equipment cause of SAIFI
#      r_hum_saifi:  Human error cause of SAIFI
#      r_lig_saifi:  Lightning cause of SAIFI
#      r_tpi_saifi:  Third party interference cause of SAIFI 
#      r_veg_saifi:  Vegetation cause of SAIFI
#      r_wlf_saifi:  Wildlife cause of SAIFI
#      a_wp:         Wood Pole
#      a_cp:         Concrete Pole or Steel Structure
#      a_ot:         Other type of Pole
#      a_bc:         Capacitor Banks
#      a_vr:         Voltage Regulator
#      a_li:         Length of Network
#      a_li_st:      Length of line used in Street Lighting
#      au_tb_li:     Line Length Table in Aurora
#      au_tb_li_st:  Street Lighting Line Table in Aurora
#      a_lv_li:      Low Voltage Lines
#      au_tb_lv_li:  Low Voltage Table in Aurora
#      a_lv_cb:      Low Voltage Cable
#      au_tb_lv_cb:  Low Voltage Cable Table in Aurora
#      au_tb_li_cb_st: Comparasion between LV Lines, Cables, and Street.
#      a_hv_li_oh:   Overhead High Voltage Line (wire conductor)
#      a_hv_li_swer: Single Wired earth return
#      a_hv_li_acc:  High Voltage Aerial Cable Conductor
#      a_hv_sb_li:   High Voltage Subtransmission Line
#      au_tb_hv_sb_li: High Voltage Subtransmission Lines in Aurora
#      a_hv_cb_xlpe:   HV Isolated Cable 
#      a_hv_cb_pilc: PILC Cable
#      a_hv_cb_sub:  Submarine Cable
#      a_li_tree:    Lines on areas with Tree Management
#      au_tb_li_tree: Length of Line under Tree Management
#      a_li_coge:    Line Length under Coastal and Geothermal effect
#      au_tb_li_coge: Table with Line Length under influency of Coastal and Geothermal
#      a_lv_con:     LV Consumer
#      s_tot_enr:    Total Energy Supplied
#      s_gxp_enr:    Energy delivered in GXPs (Grid Exit Points)
#      s_dr_enr:     Energy delivered by Distributed Resources
#      s_exp_enr:    Exported Energy to GXPs
#      s_ent_enr:    Total Energy Entering the Aurora Energy Systems.
#      r_pf:         Regulatory Profit
#      r_li_ch:      Lines Charge

# 6. Data Cleaning ###############################################

# In this chapter I will performe a extense calculation of ratios, infos, data, etc.


## 6.1. Reliability ####

       ### 5.1.1. Interruptions #### 

## Unplanned
db_neat  <- bind_cols(db_neat,
                     db_raw %>% 
                            filter(Section %in% "10(i): Interruptions",
                            Subcategory %in% "Number of interruptions",
                            Description %in% "Class C (unplanned interruptions on the network)") %>%
                                   select(r_i_un= Value)
                     )

## Planned

db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "10(i): Interruptions",
                                    Category %in% "Interruptions by class",
                                    Description %in% "Class B (planned interruptions on the network)") %>%
                             select(r_i_pl= Value)
                     )

## Total
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "10(i): Interruptions",
                                    Category %in% "Interruptions by class",
                                    Description %in% "Total") %>%
                             select(r_i_tot= Value)
                     )



       ### 5.1.3. Consumer restored in less than 3 hours ####

db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "10(i): Interruptions",
                                    Category %in% "Interruption restoration",
                                    !Description %in% ">3hrs") %>%            # ATENTION!! => DIFFERENT of Greater than 3 hour
                             select(r_less_3= Value)                          # It means: Less than 3 hours
                     )

       ### 5.1.5. Consumer restored in more than 3 hours ####

db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "10(i): Interruptions",
                                    Category %in% "Interruption restoration",
                                    Description %in% ">3hrs") %>%
                             select(r_more_3= Value)
                     )

       ### 5.1.7. Transpower influency in outages ####

## Interruptions Quantity
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "10(i): Interruptions",
                                    Category %in% "Interruptions by class",
                                    Description %in% "Class A (planned interruptions by Transpower)") %>%
                                          select(r_tp= Value) +
                      db_raw %>% 
                            filter(Section %in% "10(i): Interruptions",
                                   Category %in% "Interruptions by class",
                                   Description %in% "Class D (unplanned interruptions by Transpower)") %>%
                                          select(r_tp= Value)
                     )

## SAIDI Unplanned
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "10(i): Interruptions",
                                    Subcategory %in% "SAIDI",
                                    Description %in% "Class D (unplanned interruptions by Transpower)") %>%
                             select(r_un_tp_saidi= Value)
)

## SAIDI Planned
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "10(i): Interruptions",
                                    Subcategory %in% "SAIDI",
                                    Description %in% "Class A (planned interruptions by Transpower)") %>%
                             select(r_pl_tp_saidi= Value)
)

## SAIFI Unplanned
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "10(i): Interruptions",
                                    Subcategory %in% "SAIFI",
                                    Description %in% "Class D (unplanned interruptions by Transpower)") %>%
                             select(r_un_tp_saifi= Value)
)

## SAIFI Planned
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "10(i): Interruptions",
                                    Subcategory %in% "SAIFI",
                                    Description %in% "Class A (planned interruptions by Transpower)") %>%
                             select(r_pl_tp_saifi= Value)
)

       ### 5.1.8. SAIDI ####

## Unplanned
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "10(i): Interruptions",
                                    Subcategory %in% "SAIDI",
                                    Description %in% "Class C (unplanned interruptions on the network)") %>%
                             select(r_un_saidi= Value)
                     )

## Planned
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "10(i): Interruptions",
                                    Subcategory %in% "SAIDI",
                                    Description %in% "Class B (planned interruptions on the network)") %>%
                             select(r_pl_saidi= Value)
)

## Total
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "10(i): Interruptions",
                                    Subcategory %in% "SAIDI",
                                    Description %in% "Total") %>%
                             select(r_saidi= Value)
                     )

       ### 5.1.8. SAIFI ####

## Unplanned
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "10(i): Interruptions",
                                    Subcategory %in% "SAIFI",
                                    Description %in% "Class C (unplanned interruptions on the network)") %>%
                             select(r_un_saifi= Value)
                     )

## Planned
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "10(i): Interruptions",
                                    Subcategory %in% "SAIFI",
                                    Description %in% "Class B (planned interruptions on the network)") %>%
                             select(r_pl_saifi= Value)
                     )

## Total
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "10(i): Interruptions",
                                    Subcategory %in% "SAIFI",
                                    Description %in% "Total") %>%
                             select(r_saifi= Value)
)
       
       ### 5.1.8.1. SAIDI by Causes ####

# There are too many causes, for this reason, I will use for statement to put it in automatic
# Causes
type_desc <-  db_raw %>%    filter(Section %in% "10(ii): Class C Interruptions and Duration by Cause",
                                   Subcategory %in% "SAIDI") %>%
                                   select(Description) %>%
                                          count(Description)
# Creating Acronyms for each Cause
type_desc <- bind_cols(type_desc,Acronyms = c("ae","aw","idk","eqp","hum","lig","tpi","veg","wlf"))

# Loop
for (i in 1:nrow(type_desc))
       {
       # Save the column names
       temp <- colnames(db_neat)
       
       # Subsetting the raw data and binding with dt_neat
       db_neat  <- bind_cols(db_neat,
                             db_raw %>% 
                                    filter(Section %in% "10(ii): Class C Interruptions and Duration by Cause",
                                           Subcategory %in% "SAIDI",
                                           Description %in% type_desc[i,1]) %>%
                                    select(Value)
                            )
       
       # Naming the columns
       colnames(db_neat) <- c(temp,paste("r_",type_desc[i,3],"_saidi",sep = ""))
       }

# Excluding
rm(type_desc);rm(temp)

       ### 5.1.8.2. SAIFI by Causes #####

# Analog with the "SAIDI by Causes"
# Causes
type_desc <-  db_raw %>%    filter(Section %in% "10(ii): Class C Interruptions and Duration by Cause",
                                   Subcategory %in% "SAIFI") %>%
                                          select(Description) %>%
                                          count(Description)
# Creating Acronyms for each Cause
type_desc <- bind_cols(type_desc,Acronyms = c("ae","aw","idk","eqp","hum","lig","tpi","veg","wlf"))

# Loop
for (i in 1:nrow(type_desc))
{
       # Save the column names
       temp <- colnames(db_neat)
       
       # Subsetting the raw data and binding with dt_neat
       db_neat  <- bind_cols(db_neat,
                             db_raw %>% 
                                    filter(Section %in% "10(ii): Class C Interruptions and Duration by Cause",
                                           Subcategory %in% "SAIFI",
                                           Description %in% type_desc[i,1]) %>%
                                    select(Value)
       )
       
       # Naming the columns
       colnames(db_neat) <- c(temp,paste("r_",type_desc[i,3],"_saifi",sep = ""))
}

# Excluding temporaly variable
rm(type_desc);rm(temp)


## 5.2. Assets ####

       ### 5.10.1. Poles ####

## Wood Pole
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9a: Asset Register",
                                    Category %in% "All - Overhead  Line",
                                    Subcategory %in% "Wood poles",
                                    Description %in% "Items at end of year (quantity)") %>%
                                          select(a_wp= Value)
)

## Concrete Pole or Steel Structure
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9a: Asset Register",
                                    Category %in% "All - Overhead  Line",
                                    Subcategory %in% "Concrete poles / steel structure",
                                    Description %in% "Items at end of year (quantity)") %>%
                                          select(a_cp= Value)
)

## Other Pole
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9a: Asset Register",
                                    Category %in% "All - Overhead  Line",
                                    Subcategory %in% "Other pole types",
                                    Description %in% "Items at end of year (quantity)") %>%
                                          select(a_ot= Value)
)

       ### 5.10.1.1 Aging Pole ####

## Wood Poles

# The same problem of the SAIDI/SAIFI causes.
# Due to of variables number I will save this in a separated dataset.

type_desc <- db_raw %>% 
              filter(Section %in% "9b: Asset Age Profile",
                     Subcategory %in% "Wood poles",
                     !Description %in% c("Data accuracy (1-4)","Items at end of year (quantity)","Total assets at year end")) %>%
                            count(Description)

type_desc$Description <- gsub(pattern = "Number of assets at disclosure year end by installation date - ",replacement = "",x = type_desc$Description,ignore.case = FALSE)

rm(type_desc)

db_wp <- db_raw %>% 
       filter(Section %in% "9b: Asset Age Profile",
              Subcategory %in% "Wood poles",
              !Description %in% c("Data accuracy (1-4)","Items at end of year (quantity)","Total assets at year end"))

## Graphs                 

gp_a_db_wp <- db_wp %>% select(EDB,Network,Description,Year,Value) %>% 
                                   filter(EDB %in% "Aurora Energy", Year %in% "2017", !Network %in% "All")

ggplot(gp_a_db_wp, aes(x=Description , y= Value, fill= Network)) +
       geom_bar(stat= "identity", width = .6) +
       coord_flip() +
       labs(title="Wood Poles") +
       theme_tufte() + # Tufte theme from ggfortify
       theme(plot.title = element_text(hjust = .5),
       axis.ticks = element_blank()) + # Centre plot title
       scale_fill_brewer(palette = "Dark2") # Color palette

gp_a_db_wp <- gp_a_db_wp %>%
              filter(Description %in% c(1990:2020))

ggplot(gp_a_db_wp, aes(x=Description , y= Value, fill= Network)) +
       geom_bar(stat= "identity", width = .6) +
       coord_flip() +
       labs(title="Wood Poles") +
       theme_tufte() + # Tufte theme from ggfortify
       theme(plot.title = element_text(hjust = .5),
             axis.ticks = element_blank()) + # Centre plot title
       scale_fill_brewer(palette = "Dark2") # Color palette

## Concrete Poles

# The same problem of the SAIDI/SAIFI causes.
# Due to of variables number I will save this in a separated dataset.

type_desc <- db_raw %>% 
       filter(Section %in% "9b: Asset Age Profile",
              Subcategory %in% "Concrete poles / steel structure",
              !Description %in% c("Data accuracy (1-4)","Items at end of year (quantity)","Total assets at year end")) %>%
       count(Description)

type_desc$Description <- gsub(pattern = "Number of assets at disclosure year end by installation date - ",replacement = "",x = type_desc$Description,ignore.case = FALSE)



db_cp <- db_raw %>% 
       filter(Section %in% "9b: Asset Age Profile",
              Subcategory %in% "Concrete poles / steel structure",
              !Description %in% c("Data accuracy (1-4)","Items at end of year (quantity)","Total assets at year end"))

rm(type_desc)

## Graphs                 

gp_a_db_cp <- db_cp %>% select(EDB,Network,Description,Year,Value) %>% 
       filter(EDB %in% "Aurora Energy", Year %in% "2017", !Network %in% "All")

ggplot(gp_a_db_cp, aes(x=Description , y= Value, fill= Network)) +
       geom_bar(stat= "identity", width = .6) +
       coord_flip() +
       labs(title="Wood Poles") +
       theme_tufte() + # Tufte theme from ggfortify
       theme(plot.title = element_text(hjust = .5),
             axis.ticks = element_blank()) + # Centre plot title
       scale_fill_brewer(palette = "Dark2") # Color palette

gp_a_db_cp <- gp_a_db_cp %>%
       filter(Description %in% c(1990:2020))

ggplot(gp_a_db_cp, aes(x=Description , y= Value, fill= Network)) +
       geom_bar(stat= "identity", width = .6) +
       coord_flip() +
       labs(title="Wood Poles") +
       theme_tufte() + # Tufte theme from ggfortify
       theme(plot.title = element_text(hjust = .5),
             axis.ticks = element_blank()) + # Centre plot title
       scale_fill_brewer(palette = "Dark2") # Color palette


       ### 5.10.2. Capacitor Banks ####

db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9a: Asset Register",
                                    Category %in% "All - Capacitor Banks",
                                    Description %in% "Items at end of year (quantity)") %>%
                             select(a_bc= Value)
                     )

       ### 5.10.3. Voltage Regulator ####

db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9a: Asset Register",
                                    Category %in% "HV - Distribution Transformer",
                                    Subcategory %in% "Voltage regulators",
                                    Description %in% "Items at end of year (quantity)") %>%
                                          select(a_vr= Value)
                     )

       ### 5.3.1. Network Length ####

db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Subcategory %in% "Total circuit length (km)",
                                    Description %in% "Total circuit length (for supply)") %>%
                                          select(a_li= Value)
                     )

       ### 5.3.1.1. Street lighting ####

db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9a: Asset Register",
                                    Category %in% "LV - LV Street lighting",
                                    Description %in% "Items at start of year (quantity)") %>%
                                          select(a_li_st= Value)
)

       ### 5.3.1.2. LV Line ####

db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9a: Asset Register",
                                    Category %in% "LV - LV Line",
                                    Description %in% "Items at start of year (quantity)") %>%
                             select(a_lv_li= Value)
                     )

       ### 5.3.1.3. LV Cable ####

db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9a: Asset Register",
                                    Category %in% "LV - LV Cable",
                                    Description %in% "Items at start of year (quantity)") %>%
                             select(a_lv_cb= Value)
                     )

       ### 5.2.1.3.a. Comparasion LV-LV Lines, Cables. and Street Lighting in Aurora <===== (REMOVE - Put on the Report body) ####

au_tb_li_cb_st <- db_neat %>% select(EDB,
                                        Network,
                                        Year,
                                        "LV Lines" = a_lv_li,
                                        "LV Cables" = a_lv_cb,
                                        "Street Light" = a_li_st) %>%
                                          filter(EDB %in% "Aurora Energy")

       ### 5.3.1.4. HV Distribution Lines ####

## HV Lines
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9a: Asset Register",
                                    Category %in% "HV - Distribution Line",
                                    Subcategory %in% "Distribution OH Open Wire Conductor",
                                    Description %in% "Items at start of year (quantity)") %>%
                             select(a_hv_li_oh= Value)
                     )

## SWER - Single Wired with Earth return
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9a: Asset Register",
                                    Category %in% "HV - Distribution Line",
                                    Subcategory %in% "SWER conductor",
                                    Description %in% "Items at start of year (quantity)") %>%
                             select(a_hv_li_swer= Value)
)

## Aerial Cable Condutor
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9a: Asset Register",
                                    Category %in% "HV - Distribution Line",
                                    Subcategory %in% "Distribution OH Aerial Cable Conductor",
                                    Description %in% "Items at start of year (quantity)") %>%
                             select(a_hv_li_acc= Value)
)

## Aerial Cable Condutor
db_neat <- db_neat %>% mutate(a_hv_li = a_hv_li_oh + a_hv_li_swer + a_hv_li_acc) 

       ### 5.3.1.5. HV Subtransmission Lines ####

db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9a: Asset Register",
                                    Category %in% "HV - Subtransmission Line",
                                    Subcategory %in% "Subtransmission OH 110kV+ conductor",
                                    Description %in% "Items at start of year (quantity)") %>%
                             select(a_hv_sb_li= Value)
                     )

       ### 5.3.1.6. HV Distribution Cables ####

## XLPE Underground
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9a: Asset Register",
                                    Category %in% "HV - Distribution Cable",
                                    Subcategory %in% "Distribution UG XLPE or PVC",
                                    Description %in% "Items at start of year (quantity)") %>%
                             select(a_hv_cb_xlpe= Value)
                     )

## PILC Underground
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9a: Asset Register",
                                    Category %in% "HV - Distribution Cable",
                                    Subcategory %in% "Distribution UG PILC",
                                    Description %in% "Items at start of year (quantity)") %>%
                             select(a_hv_cb_pilc= Value)
)

## Submarine
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9a: Asset Register",
                                    Category %in% "HV - Distribution Cable",
                                    Subcategory %in% "Distribution Submarine Cable",
                                    Description %in% "Items at start of year (quantity)") %>%
                             select(a_hv_cb_sub= Value)
)

       ### 5.3.1.7. HV Subtransmission Cables ####

# Too many cases in Subcategory. "For" instance to save codes lines.
# Causes
type_desc <-  db_raw %>%    filter(Section %in% "9a: Asset Register",
                                   Category %in% "HV - Subtransmission Cable",
                                   Description %in% "Items at end of year (quantity)") %>%
                                          count(Subcategory)

# Creating Acronyms for each Cause
type_desc <- bind_cols(type_desc,Acronyms = c("sub","ug_110_gas","ug_110_oil","110_pilc","110_xlpe",
                                              "66_gas","66_oil","66_pilc","66_xlpe"))

# Loop
for (i in 1:nrow(type_desc))
{
       # Save the column names
       temp <- colnames(db_neat)
       
       # Subsetting the raw data and binding with dt_neat
       db_neat  <- bind_cols(db_neat,
                             db_raw %>% 
                                    filter(Section %in% "9a: Asset Register",
                                           Category %in% "HV - Subtransmission Cable",
                                           Description %in% "Items at end of year (quantity)",
                                           Subcategory %in% type_desc[i,1]) %>%
                                    select(Value)
       )
       
       # Naming the columns
       colnames(db_neat) <- c(temp,paste("a_",type_desc[i,3],"_hv_sb_",sep = ""))
}

# Excluding temporaly variable
rm(type_desc);rm(temp)

       ### 5.3.1.1. Length of Circuit with Tree Management ####

## For some reason I can not explain, two part of the same informations were split in differents filter()
temp <-bind_rows(db_raw %>%
                     filter(Section %in% "9c: Overhead lines and underground cables",             #
                            Category %in% "Overhead circuit requiring vegetation management",     # 175 rows
                            Subcategory %in% "Circuit length (km)",                               #
                            Description %in% "Overhead circuit requiring vegetation management"),
              
              db_raw %>% filter(Section %in% "9c: Overhead lines and underground cables",         #
                     Category %in% "Total overhead length",                                       # 20 rows
                            Subcategory %in% "Circuit length (km)",                               #
                             Description %in% "Overhead circuit requiring vegetation management")
                     )

## Ordering to ensure the ideal sequence of row
temp <- temp %>% arrange(-Year,EDB,Network)

## Copying the value to the db_neat
db_neat  <- bind_cols(db_neat,
                      temp %>% 
                             select(a_li_tree= Value)
                     )

#Excluding the temporaly variable
rm(temp)

       ### 5.3.1.1. Length of Circuit within 10km of coastline or geothermal areas ####

## The same problem faced in Tree Management
temp <-bind_rows(db_raw %>%
                        filter(Section %in% "9c: Overhead lines and underground cables",                                         #
                               Category %in% "Length of circuit within 10km of coastline or geothermal areas (where known)",     # 175 rows
                               Subcategory %in% "Circuit length (km)"),
                 
                 db_raw %>% filter(Section %in% "9c: Overhead lines and underground cables",         #
                                   Category %in% "Total overhead length",                            # 20 rows
                                   Subcategory %in% "Circuit length (km)",                           #
                                   Description %in% "Length of circuit within 10km of coastline or geothermal areas (where known)")
                )

## Ordering to ensure the ideal sequence of row
temp <- temp %>% arrange(-Year,EDB,Network)

## Copying the value to the db_neat
db_neat  <- bind_cols(db_neat,
                      temp %>% 
                             select(a_li_coge= Value)
)

#Excluding the temporaly variable
rm(temp)


       ### 5.2.2. Consumers ####

db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9a: Asset Register",
                                    Category %in% "LV - Connections",
                                    Description %in% "Items at end of year (quantity)") %>%
                             select(a_lv_con= Value)
                     )

### 5.X.X. Overhead lines ####

db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9c: Overhead lines and underground cables",
                                    Subcategory %in% "Overhead (km)",
                                    Description %in% "Total circuit length (for supply)") %>%
                             select(a_li_oh= Value)
)

### 5.X.X. Underground lines ####  

db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9c: Overhead lines and underground cables",
                                    Subcategory %in% "Underground (km)",
                                    Description %in% "Total circuit length (for supply)") %>%
                             select(a_li_ug= Value)
)

### 5.X.X. Rural Overhead lines ####

db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9c: Overhead lines and underground cables",
                                    Subcategory %in% "Circuit length (km)",
                                    Description %in% "Rural") %>%
                             select(a_li_ru= Value)
)

### 5.X.X. Urban Overhead lines ####

db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9c: Overhead lines and underground cables",
                                    Subcategory %in% "Circuit length (km)",
                                    Description %in% "Urban") %>%
                             select(a_li_ur= Value)
)

### 5.X.X. Rugged Overhead lines ####

db_neat <- mutate(db_neat,a_li_rrr = a_li_oh - a_li_ur - a_li_ru)

### 5.X.X. Total Energy Supplied and Losses ####

## Electricity entering in the system

db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9e(ii): System Demand",
                                    Category %in% "Electricity volumes carried",
                                    Description %in% "Electricity entering system for supply to consumers' connection points") %>%
                             select(s_ent_enr= Value)
                     )

## Electricity supplied from GXPs (Grids Exits Points)
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9e(ii): System Demand",
                                    Category %in% "Electricity volumes carried",
                                    Description %in% "Electricity supplied from GXPs") %>%
                             select(s_gxp_enr= Value)
                     )

## Electricity supplied from distributed generation
db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9e(ii): System Demand",
                                    Category %in% "Electricity volumes carried",
                                    Description %in% "Electricity supplied from distributed generation") %>%
                             select(s_dr_enr= Value)
                     )

## Electricity Exported

db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9e(ii): System Demand",
                                    Category %in% "Electricity volumes carried",
                                    Description %in% "Electricity exports to GXPs") %>%
                             select(s_exp_enr= Value)
                     )

## Losses

db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9e(ii): System Demand",
                                    Category %in% "Electricity volumes carried",
                                    Description %in% "Electricity losses") %>%
                             select(s_loss= Value)
                     )                      
                      
                      

## Total Energy Consumers Delivered

db_neat  <- bind_cols(db_neat,
                      db_raw %>% 
                             filter(Section %in% "9e(ii): System Demand",
                                    Category %in% "Electricity volumes carried",
                                    Description %in% "Total energy delivered to ICPs") %>%
                             select(s_tot_enr= Value)
                     )

### Regulatory

#### Regulatory Profit




```


# I. Introduction

This document aim to evaluate the Aurora Energy Network based on the disclosure data available in the Internet. Although, the availiability of these general data, they require many manipulation to became workable. Besides the lackness of specifics data to drive a deep study, I will try to extract some information in a simple descriptive analysis in the [Chapter 2](#chapter2), and later in [Chapter 3](#chapter3) a cross analysis between all company facets. In [Chapter 4](#chapter4) I will show a benchmarking and a comparison among Aurora Energy and Similars Companies. Based on the previous chapters the [Chapter 5](#chapter5) will bundle the results into a global understanding. Finally, in [Chapter 6](#chapter6) the Conclusions.  

I encorage the reader to reproduce this document in your own computer, as an outcome of my past work, I made a great effort to comment every line to let this code understandable.

# II. Sinopsis

As an result of a general study of Aurora Energy was possible to understand the company objetivies.





X
X
X
X
X



X
X

* Dashboard
* Presentation


# III. Document Structure

To navegate in this report you can use the table of content on your left side. it is easy to use, very straigthforward, and show all content until second sub-levels of each chapters.

# 1. General Information {#chapter1}

In a collaborative mindset and environment of work, I need to give the credits to the right person who aid in the research. For this reason I put this section, to describe where I acquire the data, which software, and who developed or disclosure this on the web.

## 1.1. Data Sources

All data of this analysis was downloaded in the internet.

* @NZCC1;

* [Aurora Energy Website](http://www.auroraenergy.co.nz/disclosures/)

* [GeoJSON file](https://exploratory.io/map)

The most of the features on this document is also Open Source and free for use.

## 1.2. Softwares

I performed this stydies adopting the [R Language](https://en.wikipedia.org/wiki/R_(programming_language)), which was created by [Ross Ihaka](https://en.wikipedia.org/wiki/Ross_Ihaka) and [Robert Gentleman](https://en.wikipedia.org/wiki/Robert_Gentleman_(statistician)) both professor of the University of Auckland. The IDE version and R used in this report were:

* R Version 3.5.1 ([Website](https://cran.r-project.org));

* RStudio Version 1.1.456 ([Website](https://www.rstudio.com)).

## 1.3. A briefly introduction about data

Unfornutaly, the dataset provided by ComCom is not a [*tidy dataset*](http://garrettgman.github.io/tidying/) @Grolemund, and for this reason, I need to build a new version of data base.

One reason to make a great effort to registry all data modification is due to this documents must be reproducible.


# 2. Descriptive Analysis {#chapter2}

Aurora Energy is a New Zealand Line company located majority in Otago Regional, one of the southest New Zealand's province. The population of this state is about XXXXX inhabitants. Accordlying with the 2018 Annual Report, there are more than XXXX consumers and XXXX kilometres of lines. The company is divided in two network: CentralOtago and Dunedin. The former is the most rural and the latter based on coastal occupation where is located the province capital.

```{r map-nz,echo=FALSE}
# Plot the NZ's Map with a pin in the Otago Regional
leaflet(nz_region) %>% # Call the function leaflet() and use the nz_region database.
       
       addTiles() %>% # Add the standard tiles from OpenStreet Map
       
              addMarkers(lng=169.5444,               # Longitude                #
                         lat=-45.2704,               # Latitude                 # Add a Pin in Otago Regional
                         popup="Otago Regional") %>% # Message on the Pin       #
       
                     addPolygons(color = "blue",       # Border color
                                 fillColor = "orange", # Regionals color
                                 weight = 0.5,         # Border line width
                                 highlightOptions = highlightOptions(color = "white",    # Responsive on mouse
                                                                     weight = 3,         # Border line width
                                                                     bringToFront = TRUE)) %>% 
       
                            setView(lng = 169.5444,  # Longitude
                                    -45.2704,        # Latitude
                                    zoom = 7) %>%    # Zoom to fit on screen
       
                                   addMiniMap() # Add a minimap
```

In recents news, Aurora Energy was investing to enhance the network since 2017, after a huge investment of 30 millions NZA. For this reason, this simple documents aims to find out which changes this investment bring to the company.

## 2.1. Distribution Network in Otago

The Otago's state is divided geographically into two electrical distribution (macro-grids) according with the ComCom document. Although, the lack of information I assume each District compounded by these city:

* Dunedin (Clutha District, Dunedin City, and Waitaki District);
* Central Otago (Queenstown-Lakes District and CentralOtago District).

Based on it, the Table 1 represents the consumers of each Division.

The majority of consumer was located in Dunedin, about 62.58% which represent more than 55.000 consumer, and almost 33.000 consumer was settled in Central Otago. The trend in the last 5 year is the Central Otago increasing its participation on the total share, although Dunedin also increase its connnection number. The growth observed in these last 5 years was `r round(100*(88305-84875)/84875,2)`% in Otago Regional, but looking Central Otago separetaly its growth reach `r round(100*(32943-30237)/30237,2)`%. For this reason, the Central Otago could sature your power supply.

The next sub-chapters I will 

Due to a outstanding quantity of information, I have decided to build a simple **mind map** to guide me to understandand structure  the global vision of Aurora Energy. I will share the outcome of this exercise, which help me to create this report.

<center>

<iframe width="90%" height="480xp" src="https://www.mindomo.com/mindmap/aurora-energy-df2907a8292742ee8f7e1c192781d447" frameborder="0" allowfullscreen>Your browser does not support frames. <a href="https://www.mindomo.com/mindmap/aurora-energy-df2907a8292742ee8f7e1c192781d447" target="_blank">View</a> this map on its original site. It was created using <a href="https://www.mindomo.com" target="_blank">Mindomo</a>.</iframe>

</center>

In-deth overview of Aurora Energy network to drive a better understanding of the whole picture of the company. For this reason, this sub-chapter intention to give a very detail number of equipments and device spread all over the Aurora Energy Network.


## 2.2. Assets

This sub-chapter aims to summarize all data related to Asset Quantity.

### 2.2.1. Network Assets

In this sub-chapter I will summarize the quantity of each component which is related to the Network such as: Length of LV Lines, Poles, Capacitor Banks, etc.

#### 2.2.1.1. Low Voltage and Distribution



##### 2.2.1.1.1. Consumers

As shown in Table 1, both Regional has increased past these 6 years, but the Central Otago showed a higher growth rate (increase more than 10% in 6 years) as shown in Graphic 1. The majority of consumer was based in Dunedin Regional, which represents about 62% of the total consumer. It is also possible to see a increasing trend.

##### {.tabset}

###### Table 1 {#tb1}

```{r consumer-otago-regional,echo=FALSE}
## Creating Table with Aurora Energy Consumers.
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,a_lv_con),          #                     # Creating a table
       key = Network,                                                       #
       value = a_lv_con) %>%                                                #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) -> au_con       # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(au_con,
                                  align = "c",  # Align the table and content to center 
                                   caption = "<h4>Consumers in Aurora Network</h4>", # Table Title
                                   digits = 2,                                       # Round the number
                                   format.args = list(big.mark=","),                 # Thousand mark
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total Consumers")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

###### Graphic 1 {#gr1}

```{r graph-2-2-1-1-1,echo=FALSE}
## Graph network comparing
db_neat %>%   filter(EDB %in% "Aurora Energy") %>%
                     select(EDB,
                            Network,
                            Year,
                            Value = a_lv_con) %>%
       
                            ggplot(aes(x = Year,
                                       y = Value,
                                       fill = Network)) + 
                                   geom_bar(position = position_dodge(),
                                            stat = "identity") +
                                   scale_fill_brewer(palette = "Paired") +
                                   geom_smooth(method = lm,
                                                      se= FALSE,
                                                      color= "tomato") +
                                   labs(x = "[Year]",
                                        y = "[km]",
                                        title = "Aurora Energy Consumers")
```

#####

##### 2.2.1.1.2. Lines and Cable

The Table 2 show the network length in each Regional, which is possible to observe Central Otago Regional has a bigger grid than Dunedin Regional, although a great investment in Dunedin, which increased more than 400 kilometre in one year (about `r round(100*((2925/2511)-1),2)`%). The trend line show a steadly growth rate.

##### {.tabset}

###### Table 2 {#tb2}

```{r table-aurora-network-km,echo=FALSE}
## Creating Table with Aurora Energy Overhead Lines
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,a_li),              #                     # Creating a table
       key = Network,                                                       #
       value = a_li) %>%                                                    #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Network Length in each Regional</h4>", # Table Title
                                   digits = 0,                                           # Round the number
                                   format.args = list(big.mark=","),                      # Thousand mark
                                   col.names = c("Year",               #
                                                 "Central Otago [km]",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin [km]",            #
                                                 "[%]",                #
                                                 "Total [km]")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

###### Graphic 2.1 {#gr2.1}

```{r graph-2-2-1-1-2,echo=FALSE}
## Graph network comparing
db_neat %>%   filter(EDB %in% "Aurora Energy") %>%
                     select(EDB,
                            Network,
                            Year,
                            Value = a_li) %>%
       
                            ggplot(aes(x = Year,
                                       y = Value,
                                       fill = Network)) + 
                                   geom_bar(position = position_dodge(),
                                            stat = "identity") +
                                   scale_fill_brewer(palette = "Paired") +
                                   geom_smooth(method = lm,
                                                      se= FALSE,
                                                      color= "tomato") +
                                   labs(x = "[Year]",
                                        y = "[km]",
                                        title = "Lines and Cables Length in Aurora Energy")
```

###### Graphic 2.2 {#gr2.2}

```{r graph-aurora-network,echo=FALSE}
## Graph to show the percentage among Central Otago and Dunedin
db_neat %>%   filter(EDB %in% "Aurora Energy",  # Filtering the right company
                     !Network %in% "All") %>%   #

                     select(EDB,                 #
                            Network,             # Subsetting the neat data
                            Year,                #
                            Value = a_li) %>%    #
       
                            # Plotting
                            ggplot(aes(x= Year,     # Variable Independet             
                                       y= Value,    # Variable Dependent
                                       fill= Network)) +   # Fill the bars with Network info
                                   geom_bar(stat = "identity",  # Default setting
                                            position = "fill") +
                                   labs(x = "[Years]",  # X axis label
                                        y = "[%]",      # Y axis label
                                        title = "Aurora Energy composition")   # Graph title
```

#####

The itens A and B will demonstrate the share between Overhead and Underground in the total of Table 2.

A) Overhead

```{r overhead,echo=FALSE}
## Creating Table with Aurora Energy Overhead Lines
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,a_li_oh),           #                     # Creating a table
       key = Network,                                                       #
       value = a_li_oh) %>%                                                 #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Table 1b - Overhead Lines in Aurora Network</h4>", # Table Title
                                   digits = 2,                                                             # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```


i) Rural

ii) Urban

iii) Rugged and/or Remoted

B) Underground

```{r underground,echo=FALSE}
## Creating Table with Aurora Energy Underground Lines
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,a_li_ug),           #                     # Creating a table
       key = Network,                                                       #
       value = a_li_ug) %>%                                                 #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Table 1b - Underground Lines in Aurora Network</h4>", # Table Title
                                   digits = 2,                                                             # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

C) Comparison

```{r ,echo=FALSE}
# Subsetting the db_neat to filter and select the variables to plot the graph.
db_neat %>%                               #                           #
       filter(EDB %in% "Aurora Energy",   # Filtering the dataset     #
              !Network %in% "All") %>%    #                           # Subsetting the data frame
              select(Network,                                         #
                     Year,                                            #
                     a_li_oh,                                         #
                     a_li_ug) %>%                                     #
                     mutate(Value = a_li_oh + a_li_ug) %>% # Calculating the total
                            select(Network,Year,Value) %>% # Selecting the columns desires
       
                            # Plotting the graph
                            ggplot(aes(x = Year,         # Independent varialble
                                       y = Value)) +     # Dependet variable 
              
                                   # Defining the graph's style
                                   geom_bar(position = "fill",   # Side by side bars
                                          stat = "identity",     # Deafult setting
                                          width = 0.5,           # Bar's Width
                                          aes(fill = Network))+  # Fill the bars with the Network percentage

                                   labs(x="[years]",  # X axis label
                                        y="[%]",     # Y axis label
                                        title="Overhead and Underground Lines comparison in Aurora Energy") # Graph title
```


##### 2.2.1.1.3. Street Lightning

Aurora Energy provide the service of Public Illumination in Otago Region Council. The results found was Dunedin with double of street lighting network than CentralOtago as showed in the Graphic 2, Table 2a, and table 2b.


##### {.tabset}

###### Graphic

```{r gp_li_st,echo=FALSE}
# Subsetting the db_neat to filter and select the variables to plot the graph.
db_neat %>%                               #                           #
       filter(EDB %in% "Aurora Energy",   # Filtering the dataset     #
              !Network %in% "All") %>%    #                           # Subsetting the data frame
              select(Network,                                         #
                     Year,                                            #
                     Value = a_li_st) %>%                             #

                     # plotting the graph
                     ggplot(aes(x = Year,         # Independent varialble
                                y = Value,        # Dependet variable
                                fill=Network)) +  # 
       
                            # Defining the graph's style
                            geom_bar(position = position_dodge(),  # Side by side bars
                                     stat = "identity") +          # default setting
       
                            scale_fill_brewer(palette= "Paired") + # 
       
                                   # Estimating
                                   geom_smooth(method= lm,           # Method: Linear Model
                                                 se = FALSE,         # Standard Erros
                                                 color= "tomato") +  # Line color
                            labs(x="[years]",  # X axis label
                                 y="[km]",     # Y axis label
                                 title="Street Lighting Length in Aurora Energy") # Graph title
```
<center><b>Street Lighting Comparison</b></center>

###### Table 2a

```{r echo=FALSE}
# Creating Table with Street Lines in Aurora
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,a_li_st),           #                     # Creating a table
       key = Network,                                                       #
       value = a_li_st) %>%                                                 #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Table 1b - Street Lighting Line Length by Network</h4>", # Table Title
                                   digits = 2,                                                             # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

<center><b>Table 2 - Total Street Lighting in each Network</b></center>

###### Table 2b

```{r ,echo=FALSE}
## Comparing a specific variable with the global variable.
bind_cols     (spread(data = db_neat %>%                                   #
                     filter(EDB %in% "Aurora Energy") %>%   # Filtering    #
                            select(Network,  #                             # Creating table 1
                                   Year,     # Selecting                   #
                                   a_li_st), #                             # Specific
                     key = Network,                                        #
                     a_li_st),                                             #
                     
              spread(data = db_neat %>%                     # Filtering    #
                     filter(EDB %in% "Aurora Energy") %>%                  #
                            select(Network,  #                             # Creating table 2
                                   Year,     # Selecting                   #
                                   a_li),    #                             # Global
                     key = Network,                                        #
                     a_li) %>%                                             #
                     
                     select(CentralOtago_t = CentralOtago,      #
                            Dunedin_t=Dunedin,                  # Selecting columns
                            All_t=All)) %>%                     # from table 1 and 2
       
       mutate(CentralOtago_p = 100*CentralOtago/CentralOtago_t,  #
              Dunedin_p = 100*Dunedin/Dunedin_t,                 # Creating the proportion columns
              All_p = 100*All/All_t) %>%                         #
              
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_t,  #
                     CentralOtago_p,  #
                     Dunedin,         # Rearranging the columns order
                     Dunedin_t,       #
                     Dunedin_p,       #
                     All,             #
                     All_t,           #
                     All_p) %>%       #
                     
                     arrange(-Year) %>% # Re-ordering the rows.

                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Street Lighting Line Length by Network</h4>", # Table Title
                                   digits = 2, # Round the number
                                   col.names = c("Year",               #
                                                 "Street [km]",        #
                                                 "Subtotal [km]",      #
                                                 "[%]",                # Renaming the columns
                                                 "Street [km]",        #
                                                 "Subtotal [km]",      #
                                                 "[%]",                #
                                                 "Street [km]",        #
                                                 "Total Network [km]", #
                                                 "%")) %>%             #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 3, # Nest columns' header
                                                             "Dunedin" = 3,       # to a "parent"
                                                             "Total" = 3))        #
```

<center><b>Total Street Lighting in each Network</b></center>

#####


##### 2.2.1.1.4. Tree Management

This section show the Network length under Tree Management.


##### {.tabset}

###### Graphic 3a

```{r ,echo=FALSE}
# Subsetting the db_neat to filter and select the variables to plot the graph.

db_neat %>%                               #                           #
       filter(EDB %in% "Aurora Energy",   # Filtering the dataset     #
              !Network %in% "All") %>%    #                           # Subsetting the data frame
              select(Network,                                         #
                     Year,                                            #
                     Value = a_li_tree) %>%                           #

                     # plotting the graph
                     ggplot(aes(x = Year,         # Independent varialble
                                y = Value,        # Dependet variable
                                fill=Network)) +  # 
       
                            # Defining the graph's style
                            geom_bar(position = position_dodge(),  # Side by side bars
                                     stat = "identity") +          # default setting
       
                            scale_fill_brewer(palette= "Paired") + # 
       
                                   # Estimating
                                   geom_smooth(method= lm,           # Method: Linear Model
                                                 se = FALSE,         # Standard Erros
                                                 color= "tomato") +  # Line color
                            labs(x="[years]"
                                 ,y="[km]",
                                 title="Tree Management in Aurora Energy")
```

###### Table 3a

```{r ,echo=FALSE}
# Creating a table to the Tree Management Length in Aurora
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,a_li_tree),         #                     # Creating a table
       key = Network,                                                       #
       value = a_li_tree) %>%                                               #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Tree Management Length in Aurora</h4>", # Table Title
                                   digits = 2,                                            # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

###### Obs.:


It was necessary perform two searches:

* 2013 and 2014: Section -> 9c: Overhead lines and underground cables, Categgory -> Total overhead length, Sub-category -> Circuit length (km), Description -> Overhead circuit requiring vegetation management
* 2015, 2016 and 2017: Section -> Overhead lines and underground cables, Category -> Overhead circuit requiring vegetation management, Subcategoryv -> "Circuit length (km)


#####

The length of Tree Management in Dunedin kept almost steadly comparing with Central Otago, which has increased `r round(100*(153/79.22-1),2)`% in 5 years.


##### 2.2.1.1.5. Coastal and Geothermal


As expected the Central Otago do not have areas affected by the ocean, and also do not have any kilometre in geothermal areas as the number can proof. All length are concentrated in Dunedin Network where is the most populated costal of this Region.

##### {.tabset}

###### Graphic

```{r ,echo=FALSE}
# Creating a table to the Coastal and Geothermal Areas in Aurora
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,a_li_coge),         #                     # Creating a table
       key = Network,                                                       #
       value = a_li_coge) %>%                                               #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Coastal and Geothermal Area Length in Aurora</h4>", # Table Title
                                   digits = 2,                                            # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover"),      # Responsive on mouse
                                                 full_width = F,                      # No full-width
                                                 position = "float_right") %>%        # Align on right
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

###### Graphic

```{r,echo=FALSE}
db_neat %>%   select(EDB,
                     Network,
                     Year,
                     a_li_coge) %>% 
                     filter(EDB %in% "Aurora Energy",
                            Network %in% "Dunedin") %>%
                            ggplot(aes(x = Year,
                                       y = a_li_coge)) +
                                   geom_bar(stat = "identity",
                                            fill = "tomato") +
                                   labs(x = "Year",
                                        y = "[km]",
                                        title = "Coastal and Geothermal Areas") +
                                   coord_flip()
```


#####


As I expected, there are only lines affected by the ocean salt and by the geothermal activities in the Dunedin Network. These length are increase possibly due to the network expansion. In Brazil, the coastal lines were different from the regular basis, due to the corrosive effect from the salt. There many incidents of electrical discharge the excess of salt on the 13,8 kV pillar isolator, to mitigate this incident they adopt a water jet to wash each isolator for prevent.






##### 2.2.1.1.6. Low Voltage

A) Lines

B) Cables


#### 2.2.1.2. Subtransmission



#### 2.2.1.3. High Voltage Lines



#### 2.2.1.4. Poles



A.  Wood Poles


B.  Concrete Poles and Steel Structure


C.  Other Poles


#### 2.2.1.5. Equipment




A. Capacitor Banks

B. Voltage Regulator

C. Switches


### 2.2.2. Non-network Assets

In this sub-chapter I will summarize the quantity of each component which is not related to the Network such as: Furniture, Office, Computer, etc.






### 2.1.6. LV Length Lines and Cables

The LV Lines kept steadly around 5 years with a share of `21,5%` in Central Otago and `78,5%` in Dunedin.

```{r,echo=FALSE}
# Creating a table of LV Lines in Aurora

spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,a_lv_li),           #                     # Creating a table
       key = Network,                                                       #
       value = a_lv_li) %>%                                                 #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>LV Lines in Aurora Network</h4>",       # Table Title
                                   digits = 2,                                            # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2,  # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))
```


```{r,echo=FALSE}
# Creating a table of LV Cable in Aurora

spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,a_lv_cb),           #                     # Creating a table
       key = Network,                                                       #
       value = a_lv_cb) %>%                                                 #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>LV Cables in Aurora Network</h4>",      # Table Title
                                   digits = 2,                                            # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2,  # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))
```



### 2.1.7. HV Lines Length and Cables

The HV Lines also kept steadly around 5 years with a share of `68,0%` in Central Otago and `32,0%` in Dunedin.

```{r,echo=FALSE}
# Creating a table to the HV Lines in Aurora
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,a_hv_li),           #                     # Creating a table
       key = Network,                                                       #
       value = a_hv_li) %>%                                                 #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>HV Lines in Aurora Network in Aurora</h4>", # Table Title
                                   digits = 2,                                            # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2,  # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

### 2.1.8. HV Lines Length Subtransmission

Aurora Energy do not have HV lines to subtransmission as I can see in the table X.

```{r,echo=FALSE}
# Creating a table to the HV Lines in Aurora
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,a_hv_sb_li),        #                     # Creating a table
       key = Network,                                                       #
       value = a_hv_sb_li) %>%                                              #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>HV Lines in Aurora Network</h4>",       # Table Title
                                   digits = 2,                                            # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2,  # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

### 2.2.2. Rural Overhead Lines

Almost 74% of Rural Overhead lines in Otago Regional were in Central Otago and 26% in Dunedin.

##### {.tabset}

###### Table

```{r,echo=FALSE}
# Subsetting the db_neat to create a table of Rural Length Network in Aurora Energy (Only in Overhead Lines)
# Creating a table to the HV Lines in Aurora
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,a_li_ru),           #                     # Creating a table
       key = Network,                                                       #
       value = a_li_ru) %>%                                                 #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Rural Lines in Aurora Network</h4>",       # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2,  # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

###### Table

```{r,echo=FALSE}
## Comparing a specific variable with the global variable.
bind_cols     (spread(data = db_neat %>%                                   #
                     filter(EDB %in% "Aurora Energy") %>%   # Filtering    #
                            select(Network,  #                             # Creating table 1
                                   Year,     # Selecting                   #
                                   a_li_ru), #                             # Specific
                     key = Network,                                        #
                     a_li_ru),                                             #
                     
              spread(data = db_neat %>%                     # Filtering    #
                     filter(EDB %in% "Aurora Energy") %>%                  #
                            select(Network,  #                             # Creating table 2
                                   Year,     # Selecting                   #
                                   a_li_oh), #                             # Global
                     key = Network,                                        #
                     a_li_oh) %>%                                          #
                     
                     select(CentralOtago_t = CentralOtago,      #
                            Dunedin_t=Dunedin,                  # Selecting columns
                            All_t=All)) %>%                     # from table 1 and 2
       
       mutate(CentralOtago_p = 100*CentralOtago/CentralOtago_t,  #
              Dunedin_p = 100*Dunedin/Dunedin_t,                 # Creating the proportion columns
              All_p = 100*All/All_t) %>%                         #
              
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_t,  #
                     CentralOtago_p,  #
                     Dunedin,         # Rearranging the columns order
                     Dunedin_t,       #
                     Dunedin_p,       #
                     All,             #
                     All_t,           #
                     All_p) %>%       #
                     
                     arrange(-Year) %>% # Re-ordering the rows.

                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Rural Line Length in comparison with Overhead Lines</h4>", # Table Title
                                   digits = 2, # Round the number
                                   col.names = c("Year",               #
                                                 "Rural [km]",         #
                                                 "Overhead [km]",      #
                                                 "[%]",                # Renaming the columns
                                                 "Rural [km]",         #
                                                 "Overhead [km]",      #
                                                 "[%]",                #
                                                 "Rural [km]",         #
                                                 "Total Overhead [km]", #
                                                 "[%]")) %>%             #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,                 #
                                                             "Central Otago" = 3,      # Nest columns' header
                                                             "Dunedin" = 3,            # to a "parent"
                                                             "Otago Regional" = 3))    #
```

#####

More than 85% of the network in CentralOtago was in Rural Area.

More than 37% of the Dunedin was in Rural Area.


### 2.2.3. Urban Overhead Lines

##### {.tabset}

###### Table

```{r,echo=FALSE}
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,a_li_ur),           #                     # Creating a table
       key = Network,                                                       #
       value = a_li_ur) %>%                                                 #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Urban Lines in Aurora Network</h4>",       # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2,  # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

###### Table

```{r,echo=FALSE}
## Comparing a specific variable with the global variable.
bind_cols     (spread(data = db_neat %>%                                   #
                     filter(EDB %in% "Aurora Energy") %>%   # Filtering    #
                            select(Network,  #                             # Creating table 1
                                   Year,     # Selecting                   #
                                   a_li_ur), #                             # Specific
                     key = Network,                                        #
                     a_li_ur),                                             #
                     
              spread(data = db_neat %>%                     # Filtering    #
                     filter(EDB %in% "Aurora Energy") %>%                  #
                            select(Network,  #                             # Creating table 2
                                   Year,     # Selecting                   #
                                   a_li_oh), #                             # Global
                     key = Network,                                        #
                     a_li_oh) %>%                                          #
                     
                     select(CentralOtago_t = CentralOtago,      #
                            Dunedin_t=Dunedin,                  # Selecting columns
                            All_t=All)) %>%                     # from table 1 and 2
       
       mutate(CentralOtago_p = 100*CentralOtago/CentralOtago_t,  #
              Dunedin_p = 100*Dunedin/Dunedin_t,                 # Creating the proportion columns
              All_p = 100*All/All_t) %>%                         #
              
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_t,  #
                     CentralOtago_p,  #
                     Dunedin,         # Rearranging the columns order
                     Dunedin_t,       #
                     Dunedin_p,       #
                     All,             #
                     All_t,           #
                     All_p) %>%       #
                     
                     arrange(-Year) %>% # Re-ordering the rows.

                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Urban Line Length comparison with Overhead Lines</h4>", # Table Title
                                   digits = 2, # Round the number
                                   col.names = c("Year",               #
                                                 "Urban [km]",         #
                                                 "Overhead [km]", #
                                                 "[%]",                # Renaming the columns
                                                 "Urban [km]",         #
                                                 "Overhead [km]",      #
                                                 "[%]",                #
                                                 "Urban [km]",         #
                                                 "Total Overhead [km]",#
                                                 "[%]")) %>%             #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,                 #
                                                             "Central Otago" = 3,      # Nest columns' header
                                                             "Dunedin" = 3,            # to a "parent"
                                                             "Otago Regional" = 3))    #
```


#####

Less than 15% of the network in CentralOtago was in Rural Area.

Less than 63% of the Dunedin was in Rural Area.

### 2.2.4. Rugged Overhead Lines

##### {.tabset}

###### Table


```{r,echo=FALSE}

spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,a_li_rrr),           #                    # Creating a table
       key = Network,                                                       #
       value = a_li_rrr) %>%                                                #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Remote and/or Rugged Lines in Aurora Network</h4>", # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2,  # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #

```

###### Table

```{r,echo=FALSE}
## Comparing a specific variable with the global variable.
bind_cols     (spread(data = db_neat %>%                                   #
                     filter(EDB %in% "Aurora Energy") %>%   # Filtering    #
                            select(Network,  #                             # Creating table 1
                                   Year,     # Selecting                   #
                                   a_li_rrr),#                             # Specific
                     key = Network,                                        #
                     a_li_rrr),                                            #
                     
              spread(data = db_neat %>%                     # Filtering    #
                     filter(EDB %in% "Aurora Energy") %>%                  #
                            select(Network,  #                             # Creating table 2
                                   Year,     # Selecting                   #
                                   a_li_oh), #                             # Global
                     key = Network,                                        #
                     a_li_oh) %>%                                          #
                     
                     select(CentralOtago_t = CentralOtago,      #
                            Dunedin_t=Dunedin,                  # Selecting columns
                            All_t=All)) %>%                     # from table 1 and 2
       
       mutate(CentralOtago_p = 100*CentralOtago/CentralOtago_t,  #
              Dunedin_p = 100*Dunedin/Dunedin_t,                 # Creating the proportion columns
              All_p = 100*All/All_t) %>%                         #
              
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_t,  #
                     CentralOtago_p,  #
                     Dunedin,         # Rearranging the columns order
                     Dunedin_t,       #
                     Dunedin_p,       #
                     All,             #
                     All_t,           #
                     All_p) %>%       #
                     
                     arrange(-Year) %>% # Re-ordering the rows.

                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Remote and/or Rugged Overhead Lines Comparison</h4>", # Table Title
                                   digits = 2, # Round the number
                                   col.names = c("Year",               #
                                                 "Urban [km]",         #
                                                 "Overhead [km]", #
                                                 "[%]",                # Renaming the columns
                                                 "Urban [km]",         #
                                                 "Overhead [km]",      #
                                                 "[%]",                #
                                                 "Urban [km]",         #
                                                 "Total Overhead [km]",#
                                                 "[%]")) %>%             #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,                 #
                                                             "Central Otago" = 3,      # Nest columns' header
                                                             "Dunedin" = 3,            # to a "parent"
                                                             "Otago Regional" = 3))    #


```

## 2.2. Pole



### 2.2.1. Wood Pole

```{r,echo=FALSE}
## Wood Pole
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,a_wp),              #                     # Creating a table
       key = Network,                                                       #
       value = a_wp) %>%                                                    #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Wood Poles in Aurora Network</h4>",        # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

#### 2.2.1.2. Aged Poles



### 2.2.2. Concrete and Steel Pole

```{r ,echo=FALSE}
## Concrete Pole
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,a_cp),              #                     # Creating a table
       key = Network,                                                       #
       value = a_cp) %>%                                                    #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Concrete Poles in Aurora Network</h4>",    # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

#### 2.2.2.1. Aged Concrete and Steel Pole 



### 2.2.2. Other types of Pole

```{r ,echo=FALSE}
## Other type of Pole
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,a_ot),              #                     # Creating a table
       key = Network,                                                       #
       value = a_ot) %>%                                                    #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Concrete Poles in Aurora Network</h4>",    # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```


## 2.3. Equipments on the grid


### 2.3.1. Capacitor Banks

```{r ,echo=FALSE}
## Quantity of Capacitor Banks
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,a_bc),              #                     # Creating a table
       key = Network,                                                       #
       value = a_bc) %>%                                                    #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Capacitor Banks in Aurora Network</h4>",    # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

### 2.3.2. Voltage Regulator

```{r ,echo=FALSE}
## Quantity of Voltage Regulator
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,a_vr),              #                     # Creating a table
       key = Network,                                                       #
       value = a_vr) %>%                                                    #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Voltage Regulator in Aurora Network</h4>",    # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

### 2.3.3. Switches



## 2.4. Realiability

Following the ComCom document formatation, I divided my report into Interruptions Planned and Unplanned.

### 2.4.1. Interruptions

```{r,echo=FALSE}
## Total Interruptions in Aurora Energy
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,r_i_tot),           #                     # Creating a table
       key = Network,                                                       #
       value = r_i_tot) %>%                                                 #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Interruptions in Aurora Network</h4>",    # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

#### 2.4.2.1. Planned Interruptions

```{r,echo=FALSE}
## Total Interruptions in Aurora Energy
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,r_i_pl),            #                     # Creating a table
       key = Network,                                                       #
       value = r_i_pl) %>%                                                  #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Planned Interruptions in Aurora Network</h4>",    # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

#### 2.4.2.2. Unplanned Interruptions

```{r,echo=FALSE}
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,r_i_un),            #                     # Creating a table
       key = Network,                                                       #
       value = r_i_un) %>%                                                  #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Unplanned Interruptions in Aurora Network</h4>",    # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

#### 2.4.2.3. Less than 3 hours

```{r,echo=FALSE}
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,r_less_3),          #                     # Creating a table
       key = Network,                                                       #
       value = r_less_3) %>%                                                #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Interruptions restored in less than 3 hours in Aurora Network</h4>",    # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

#### 2.4.2.4. More than 3 hours

```{r,echo=FALSE}
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,r_more_3),          #                     # Creating a table
       key = Network,                                                       #
       value = r_more_3) %>%                                                #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Interruptions restored in more than 3 hours in Aurora Network</h4>",    # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

#### 2.4.2.5. Interruption rate

```{r,echo=FALSE}
## Total Interruptions Rate in Aurora Energy

# Temporaly variable
temp <- spread(data = db_neat %>%      
              filter(EDB %in% "Aurora Energy") %>%    
                     select(Network,Year,a_li),
              key = Network,
              value = a_li)

# Creating the table
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,r_i_tot),           #                     # Creating a table
       key = Network,                                                       #
       value = r_i_tot) %>%                                                 #
       
       mutate(co_a_li = temp$CentralOtago,
              du_a_li = temp$Dunedin,
              all_a_li = temp$All,
              CentralOtago_p = 100*CentralOtago/co_a_li,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/du_a_li,            #
              All_p = 100*All/all_a_li) %>%               # 
                     
              select(Year,            #
                     CentralOtago,    #
                     co_a_li,         #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     du_a_li,         #
                     Dunedin_p,       #
                     All,             #
                     all_a_li,        #
                     All_p) %>%       #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Interruptions in Aurora Network</h4>",    # Table Title
                                   digits = 2,                                              # Round the number
                                   col.names = c("Year",               #
                                                 "Interruptions",      #
                                                 "[km]",               # Renaming the columns
                                                 "[Int./km]",          #
                                                 "Interruptions",      #
                                                 "[km]",               #
                                                 "[Int./km]",          #
                                                 "Interruptions",      #
                                                 "[km]",               #
                                                 "[Int./km]")) %>%     #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",          # Rows alterning color
                                                                       "hover")) %>%       # Responsive on mouse
                                          add_header_above(c(" " = 1,               #
                                                             "Central Otago" = 3,   # Nest columns' header
                                                             "Dunedin" = 3,         # to a "parent"
                                                             "Aurora Energy" = 3))  #
# Removing the temporaly variable
rm(temp)
```


### 2.4.2. SAIDI

```{r,echo=FALSE}
## SAIDI in Otago Regional

## ATENTION!!!
## I used the Consumer Number to weigth the Percentage, and I also normalized to force.
## 

spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,r_saidi),           #                     # Creating a table
       key = Network,                                                       #
       value = r_saidi) %>%                                                 #
       
       mutate(CentralOtago_p = 100/(1+((Dunedin*au_con$Dunedin)/(CentralOtago*au_con$CentralOtago))),  # Adding percentage columns
              Dunedin_p = 100/(1+((CentralOtago*au_con$CentralOtago)/(Dunedin*au_con$Dunedin)))) %>%             # Correction Factor based on consumers quantity
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)

                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>SAIDI Total in Aurora Network</h4>",    # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

#### 2.4.2.1. SAIDI caused by Planned Interruptions

```{r,echo=FALSE}
## SAIDI of Planned Interruptions

## ATENTION!!!
## I used the Consumer Number to weigth the Percentage, and I also normalized to force.
## 
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,r_pl_saidi),        #                     # Creating a table
       key = Network,                                                       #
       value = r_pl_saidi) %>%                                              #
       
       mutate(CentralOtago_p = 100/(1+((Dunedin*au_con$Dunedin)/(CentralOtago*au_con$CentralOtago))),  # Adding percentage columns
              Dunedin_p = 100/(1+((CentralOtago*au_con$CentralOtago)/(Dunedin*au_con$Dunedin)))) %>%             # Correction Factor based on consumers quantity
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>SAIDI by Planned Interruptions in Aurora Network</h4>",    # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```


#### 2.4.2.2. SAIDI caused by Unplanned Interruptions

```{r,echo=FALSE}
## SAIDI of Unplanned Interruptions

## ATENTION!!!
## I used the Consumer Number to weigth the Percentage, and I also normalized to force.
## 
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,r_un_saidi),        #                     # Creating a table
       key = Network,                                                       #
       value = r_un_saidi) %>%                                              #
       
       mutate(CentralOtago_p = 100/(1+((Dunedin*au_con$Dunedin)/(CentralOtago*au_con$CentralOtago))),  # Adding percentage columns
              Dunedin_p =  100/(1+((CentralOtago*au_con$CentralOtago)/(Dunedin*au_con$Dunedin)))) %>%        # Correction Factor based on consumers quantity
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>SAIDI by Unplanned Interruptions in Aurora Network</h4>",    # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

#### 2.4.2.3. SAIDI caused

```{r,echo=FALSE,warning=FALSE}
db_raw %>%    filter(Section %in% "10(ii): Class C Interruptions and Duration by Cause",
                     Subcategory %in% "SAIDI") %>%
                     
                     select(EDB,Network,Year,Description,Value) %>%
                            
                            ggplot(aes(x = Year,
                                       y = Value,
                                       fill = Description)) +
                                   geom_bar(stat = "identity")
```


### 2.4.3. SAIFI

```{r,echo=FALSE}
## SAIFI in Otago Regional

## ATENTION!!!
## I used the Consumer Number to weigth the Percentage, and I also normalized to force.
## 

spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,r_saifi),           #                     # Creating a table
       key = Network,                                                       #
       value = r_saifi) %>%                                                 #
       
       mutate(CentralOtago_p = 100/(1+((Dunedin*au_con$Dunedin)/(CentralOtago*au_con$CentralOtago))),  # Adding percentage columns
              Dunedin_p = 100/(1+((CentralOtago*au_con$CentralOtago)/(Dunedin*au_con$Dunedin)))) %>%             # Correction Factor based on consumers quantity
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)

                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>SAIFI Total in Aurora Network</h4>",    # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```


#### 2.4.2.1. SAIFI caused by Planned Interruptions

```{r,echo=FALSE}
## SAIFI of Planned Interruptions

## ATENTION!!!
## I used the Consumer Number to weigth the Percentage, and I also normalized to force.
## 
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,r_pl_saifi),        #                     # Creating a table
       key = Network,                                                       #
       value = r_pl_saifi) %>%                                              #
       
       mutate(CentralOtago_p = 100/(1+((Dunedin*au_con$Dunedin)/(CentralOtago*au_con$CentralOtago))),  # Adding percentage columns
              Dunedin_p = 100/(1+((CentralOtago*au_con$CentralOtago)/(Dunedin*au_con$Dunedin)))) %>%             # Correction Factor based on consumers quantity
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>SAIFI by Planned Interruptions in Aurora Network</h4>",    # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```


#### 2.4.2.2. SAIFI caused by Unplanned Interruptions

```{r,echo=FALSE}
## SAIFI of Unplanned Interruptions

## ATENTION!!!
## I used the Consumer Number to weigth the Percentage, and I also normalized to force.
## 
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,r_un_saifi),        #                     # Creating a table
       key = Network,                                                       #
       value = r_un_saifi) %>%                                              #
       
       mutate(CentralOtago_p = 100/(1+((Dunedin*au_con$Dunedin)/(CentralOtago*au_con$CentralOtago))),  # Adding percentage columns
              Dunedin_p =  100/(1+((CentralOtago*au_con$CentralOtago)/(Dunedin*au_con$Dunedin)))) %>%        # Correction Factor based on consumers quantity
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>SAIFI by Unplanned Interruptions in Aurora Network</h4>",    # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```


#### 2.4.2.3. SAIFI caused

```{r,echo=FALSE,warning=FALSE}
db_raw %>%    filter(Section %in% "10(ii): Class C Interruptions and Duration by Cause",
                     Subcategory %in% "SAIFI") %>%
                     
                     select(EDB,Network,Year,Description,Value) %>%
                            
                            ggplot(aes(x = Year,
                                       y = Value,
                                       fill = Description)) +
                                   geom_bar(stat = "identity")
```




## 2.5. Aurora Energy Network System


### 2.5.1. Energy Supply

```{r,echo=FALSE}
## Total Energy Entering in Aurora Energy
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,s_ent_enr),         #                    # Creating a table
       key = Network,                                                       #
       value = s_ent_enr) %>%                                               #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Total Energy Entering in Aurora Energy Network</h4>",    # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

### 2.5.1. Total Energy Distributed/Supplied

```{r,echo=FALSE}
## Total Energy Supplied
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,s_tot_enr),          #                    # Creating a table
       key = Network,                                                       #
       value = s_tot_enr) %>%                                               #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>otal Energy Supplied by Network</h4>",    # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

### 2.5.1. Losses

```{r,echo=FALSE}
## Total Losses
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,s_loss),            #                     # Creating a table
       key = Network,                                                       #
       value = s_loss) %>%                                                  #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Losses</h4>",    # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```


#### 2.5.1.1. GXP Energy Delivered

```{r,echo=FALSE}
## Total Energy Supplied by GXP
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,s_gxp_enr),         #                    # Creating a table
       key = Network,                                                       #
       value = s_gxp_enr) %>%                                               #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>GXP Energy Supplied by Network</h4>",    # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

#### 2.5.1.2. DR Energy Delivered

```{r,echo=FALSE}
## Total Energy Supplied by GXP
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,s_dr_enr),         #                    # Creating a table
       key = Network,                                                       #
       value = s_dr_enr) %>%                                               #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Distributed Energy Supplied by Network</h4>",    # Table Title
                                   digits = 2,                                               # Round the number
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

#### 2.5.1.3. Exported Energy

```{r,echo=FALSE}
## Total Energy Exported to GXP
spread(data = db_neat %>%                             #                     #
       filter(EDB %in% "Aurora Energy") %>%           # Subsetting a table  #
              select(Network,Year,s_exp_enr),         #                     # Creating a table
       key = Network,                                                       #
       value = s_exp_enr) %>%                                               #
       
       mutate(CentralOtago_p = 100*CentralOtago/All,  # Adding percentage columns
              Dunedin_p = 100*Dunedin/All) %>%        # 
                     
              select(Year,            #
                     CentralOtago,    #
                     CentralOtago_p,  # Re-ordering the columns
                     Dunedin,         #
                     Dunedin_p,       #
                     All) %>%         #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Energy Exported to GPXs</h4>",    # Table Title
                                   digits = 2,                                               # Round the number
                                   format.args = list(big.mark=","),                            # Thousand mark
                                   col.names = c("Year",               #
                                                 "Central Otago",      #
                                                 "[%]",                # Renaming the columns
                                                 "Dunedin",            #
                                                 "[%]",                #
                                                 "Total")) %>%         #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,             #
                                                             "Central Otago" = 2, # Nest columns' header
                                                             "Dunedin" = 2,       # to a "parent"
                                                             " " = 1))            #
```

## 2.6. Regulatory


### 2.6.1. Regulatory Profit (including financial incentives and wash-ups)

```{r,echo=FALSE}
# Creating a table of Regulatory Profit
db_raw %>%                                                                                      #
       filter(EDB %in% "Aurora Energy",                                                                       # 
              Section %in% "3(i): Regulatory Profit",                                                         # Creating table
              Description %in% c("Regulatory profit / (loss)",                                                #
                                 "Regulatory profit/(loss) including financial incentives and wash-ups")) %>% #
              select(Year,r_pf = Value) %>%  # Selecting the columns                                  #

                     arrange(-Year) -> au_r_pf  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable( au_r_pf,
                                   align = "c",  # Align the table and content to center 
                                   caption = "<h4>Regulatory Profit</h4>",    # Table Title
                                   digits = 2,  # Round the number
                                   format.args = list(big.mark=","),                            # Thousand mark
                                   col.names = c("Year",                # Header Renaming
                                                 "[000 $]")) %>%        #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover"))      # Responsive on mouse
```

### 2.6.2. Regulatory Tax Allowance

```{r,echo=FALSE}
# Creating a table of Regulatory Tax Allowance
db_raw %>%                                                                                     #
       filter(EDB %in% "Aurora Energy",                                                                      #
              Section %in% "3(i): Regulatory Profit",                                                        # Creating table
              Description %in% "Regulatory tax allowance") %>%                                               #
              select(Year,r_tx_al = Value) %>% # Selecting the columns                                  #

                     arrange(-Year) %>% # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable( align = "c",  # Align the table and content to center 
                                   caption = "<h4>Regulatory Tax Allowance</h4>",    # Table Title
                                   digits = 2,  # Round the number
                                   col.names = c("Year",                # Header Renaming
                                                 "[000 $]")) %>%        #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover"))      # Responsive on mouse
```

```{r, echo=FALSE}
bind_cols(db_raw %>%                                                        #
       filter(EDB %in% "Aurora Energy",                                     #
              Category %in% "Regulatory taxable income",                    # Selecting and 
              Description %in% "Regulatory taxable income") %>%             # Filtering 
              select(Year,rg_tax_income = Value),                                # variable 3

db_raw %>%                                                               #
       filter(EDB %in% "Aurora Energy",                                  #
              Section %in% "2(ii): Information Supporting the ROI",         # Selecting and 
              Description %in% "Corporate tax rate (%)") %>%             # Filtering 
              select(rg_ind_tax = Value)                                 # variable 3
          ) %>%
              mutate(rg_ind_tax = 100*rg_ind_tax,allowance = rg_ind_tax * rg_tax_income / 100 ) %>%

# Plotting the table
kable( align = "c",                                                 # Align the table and content to center 
       caption = "<h4>Regulatory Allowance Tax</h4>",                          # Table Title
       digits = 2,                                                  # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                    # 1. 
                     "Regulatory taxable income",      # 2.
                     "Corporate tax rate (%)",     # 3. 
                     "Regulatory Allowance")) %>%              # 5.

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",    # Rows alterning color
                                          "hover"))      # Responsive on mouse

```


### 2.6.3. Regulatory Profit (before tax)

Regulatory Profit (before tax) = Regulatory Profit (including financial incentives and wash-ups) + Regulatory Tax Allowance

```{r,echo=FALSE}
# Creating a table of Regulatory Profit Before Tax
db_raw %>%                                                                                                   #
       filter(EDB %in% "Aurora Energy",                                                                      #
              Section %in% "3(i): Regulatory Profit",                                                        #
              Category %in% "Regulatory profit / (loss) before tax",                                         # Creating table
              Description %in% "Regulatory profit / (loss) before tax") %>%                                  #
              
              select(Year,                #
                     r_pf_tx = Value) %>% # Selecting the columns

                     arrange(-Year) %>% # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable( align = "c",  # Align the table and content to center 
                                   caption = "<h4> Regulatory Profit Before Tax</h4>",    # Table Title
                                   digits = 2,  # Round the number
                                   format.args = list(big.mark=","),                            # Thousand mark
                                   col.names = c("Year",                # Header Renaming
                                                 "[000 $]")) %>%        #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover"))      # Responsive on mouse
```

#### 2.6.3.1. Tax Additions

```{r,echo=FALSE}
## Tax Additions
bind_cols(    db_raw %>%                                                                                       #
       filter(EDB %in% "Aurora Energy",                                                                        #
              Section %in% "5a(i): Regulatory Tax Allowance",                                                  #
              Category %in% "(tax additions)",                                                                 # Selecting and 
              Description %in% "Income not included in regulatory profit / (loss) before tax but taxable") %>% # Filtering 
              select(Year,                                                                                     # variable 1
                     rg_tax_1 = Value),                                                                        #

db_raw %>%                                                                                                     #
       filter(EDB %in% "Aurora Energy",                                                                        #
              Section %in% "5a(i): Regulatory Tax Allowance",                                                  #
              Category %in% "(tax additions)",                                                                 # Selecting and 
              Description %in% "Expenditure or loss in regulatory profit / (loss) before tax but not deductible") %>% # Filtering 
              select(rg_tax_2 = Value),                                                                        # variable 2

db_raw %>%                                                                                                     #
       filter(EDB %in% "Aurora Energy",                                                                        #
              Section %in% "5a(i): Regulatory Tax Allowance",                                                  #
              Category %in% "(tax additions)",                                                                 # Selecting and 
              Description %in% "Amortisation of initial differences in asset values") %>%                      # Filtering 
              select(rg_tax_3 = Value),                                                                        # variable 3

db_raw %>%                                                                                                     #
       filter(EDB %in% "Aurora Energy",                                                                        #
              Section %in% "5a(i): Regulatory Tax Allowance",                                                  #
              Category %in% "(tax additions)",                                                                 # Selecting and 
              Description %in% "Amortisation of revaluations") %>%                                             # Filtering 
              select(rg_tax_4 = Value),                                                                        # variable 4

db_raw %>%                                                                                                     #
       filter(EDB %in% "Aurora Energy",                                                                        #
              Section %in% "5a(i): Regulatory Tax Allowance",                                                  #
              Category %in% "(tax additions)",                                                                 # Selecting and 
              Description %in% "(tax additions)") %>%                                                          # Filtering 
              select(rg_tax_add = Value)) -> au_rg_tax_add                                                     # variable 5

# Plotting the table
kable( au_rg_tax_add,
       align = "c",                                                 # Align the table and content to center 
       caption = "<h4>Tax Additions</h4>",                          # Table Title
       digits = 2,                                                  # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                    # 1. 
                     "Income not Include",      # 2.
                     "Expenditure or Loss",     # 3. 
                     "Initial differences",     # 4.
                     "Revaluations",            # 5.
                     "Total")) %>%              # 6.

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",    # Rows alterning color
                                          "hover")) %>%  # Responsive on mouse

              # Nest columns' header
              add_header_above(c(" " = 1,
                                 "Regulatory Profit not taxable/deductible" = 2,
                                 "Amortisation" = 2,
                                 " " = 1))
```

#### 2.6.3.2. Tax Deductions

```{r,echo=FALSE}
## Tax Additions
bind_cols(    db_raw %>%                                                                                       #
       filter(EDB %in% "Aurora Energy",                                                                        #
              Section %in% "5a(i): Regulatory Tax Allowance",                                                  #
              Category %in% "(tax deductions)",                                                                 # Selecting and 
              Description %in% "Income included in regulatory profit / (loss) before tax but not taxable") %>% # Filtering 
              select(Year,                                                                                     # variable 1
                     rg_tax_ded_1 = Value),                                                                        #

db_raw %>%                                                                                                     #
       filter(EDB %in% "Aurora Energy",                                                                        #
              Section %in% "5a(i): Regulatory Tax Allowance",                                                  #
              Category %in% "(tax deductions)",                                                                 # Selecting and 
              Description %in% c("Expenditure or loss deductible but not in regulatory profit / (loss) before tax**",
                                 "Expenditure or loss deductible but not in regulatory profit / (loss) before tax")) %>% # Filtering 
              select(rg_tax_ded_2 = Value),                                                                        # variable 2

db_raw %>%                                                                                                     #
       filter(EDB %in% "Aurora Energy",                                                                        #
              Section %in% "5a(i): Regulatory Tax Allowance",                                                  #
              Category %in% "(tax deductions)",                                                                 # Selecting and 
              Description %in% c("Discretionary discounts and customer rebates",
                                 "Discretionary discounts and consumer rebates")) %>%                      # Filtering 
              select(rg_tax_ded_3 = Value),                                                                        # variable 3

db_raw %>%                                                                                                     #
       filter(EDB %in% "Aurora Energy",                                                                        #
              Subcategory %in% "RAB",                                                                          #
              Category%in% "Revaluations",                                                                     # Selecting and 
              Description %in% "Total revaluations") %>%                                                       # Filtering 
              select(rg_tax_ded_4 = Value),                                                                        # variable 4

db_raw %>%                                                                                                     #
       filter(EDB %in% "Aurora Energy",                                                                        #
              Section %in% "5a(i): Regulatory Tax Allowance",                                                  #
              Category %in% "(tax deductions)",                                                                 # Selecting and 
              Description %in% "Notional deductible interest") %>%                                             # Filtering 
              select(rg_tax_ded_5 = Value),

db_raw %>%                                                                                                      #
       filter(EDB %in% "Aurora Energy",                                                                         #
              Section %in% "5a(i): Regulatory Tax Allowance",                                                   #
              Category %in% "(tax deductions)",                                                                 # Selecting and 
              Description %in% "(tax deductions)") %>%                                                          # Filtering 
              select(rg_tax_ded = Value)) -> au_rg_tax_dedu                                                     # variable 5

# Plotting the table
kable( au_rg_tax_dedu,
       align = "c",                                                 # Align the table and content to center 
       caption = "<h4>Tax Additions</h4>",                          # Table Title
       digits = 2,                                                  # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                    # 1. 
                     "Income not Include",      # 2.
                     "Expenditure or Loss",     # 3. 
                     "Discretionary Discount",     # 4.
                     "Revaluations",            # 5.
                     "Notional deductible interest", # 6.
                     "Total")) %>%              # 7.

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",    # Rows alterning color
                                          "hover")) %>%  # Responsive on mouse

              # Nest columns' header
              add_header_above(c(" " = 1,
                                 "Regulatory Profit not taxable/deductible" = 2,
                                 " " = 1,
                                 " " = 1,
                                 " " = 1,
                                 " " = 1))
```

#### 2.6.3.3. Regulatory Profit Composition

```{r, echo=FALSE}
bind_cols(Year = au_rg_tax_add$Year,
          rg_tax_add = au_rg_tax_add$rg_tax_add,
          rg_tax_ded = au_rg_tax_dedu$rg_tax_ded,
          
db_raw %>%                                                                  #
       filter(EDB %in% "Aurora Energy",                                     #
              Category %in% "Regulatory taxable income",                    # Selecting and 
              Description %in% "Regulatory taxable income") %>%             # Filtering 
              select(rg_tax_income = Value),                                # variable 3

db_raw %>%                                                                  #
       filter(EDB %in% "Aurora Energy",                                     #
              Section %in% "5a(i): Regulatory Tax Allowance",               #
              Category %in% "Regulatory profit / (loss) before tax",        # Selecting and 
              Description %in% "Regulatory profit / (loss) before tax") %>% # Filtering 
              select(rg_prof_bf = Value)                                    # variable 3
          ) %>%


# Plotting the table
kable( align = "c",                                                 # Align the table and content to center 
       caption = "<h4>Regulatory Profit Before Tax</h4>",                          # Table Title
       digits = 2,                                                  # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                    # 1. 
                     "Addition",      # 2.
                     "Deduction",     # 3. 
                     "Regulatory Income Taxable",     # 4.
                     "Regulatory Profit")) %>%              # 5.

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",    # Rows alterning color
                                          "hover")) %>%  # Responsive on mouse

              # Nest columns' header
              add_header_above(c(" " = 1,
                                 "Taxes" = 2,
                                 " " = 1,
                                 " " = 1))
```

### 2.6.4. Total Depreciation

```{r,echo=FALSE}
# Creating a table of Total Depreciation
db_raw %>%                                                                                     #
       filter(EDB %in% "Aurora Energy",                                                                      #
              Section %in% "3(i): Regulatory Profit",                                                        # Creating table
              Description %in% "Total depreciation") %>%                                                     #
              select(Year,rg_dp = Value) %>% # Selecting the columns                                     #

                     arrange(-Year) -> au_rg_dp # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable( au_rg_dp,
                                   align = "c",  # Align the table and content to center 
                                   caption = "<h4>Total Depreciation</h4>",    # Table Title
                                   digits = 2,  # Round the number
                                   col.names = c("Year",                # Header Renaming
                                                 "[000 $]")) %>%        #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover"))      # Responsive on mouse
```

```{r graph-2-6-4,echo=FALSE}
# Bar plot with Descriptions Stacked
db_raw %>%                                                          #
       filter(EDB %in% "Aurora Energy",                             # Filtering
              Section %in% "4(vii): Disclosure by Asset Category",  #
              Subcategory %in% "Total depreciation",                #
              !Description %in% "Total") %>%   # Excluding Total    #

              mutate(Value = Value/1000) %>%   # Converting to Millions
       
                     select(Year,
                            Description,
                            Value) %>%
                     
                            # Plotting
                            ggplot(aes(x = Year,   # X Axis as Year
                                   y = Value,      # Y Axis $
                                   fill = Description)) +
                            # Bar Plot
                            geom_bar(stat = "identity") +
                            labs(x = "[Years]",
                                 y = "[Millions $]",
                                 title = "Depreciation Segmentation")
```

```{r,echo=FALSE}
## RAB Adjustment Table
bind_cols(    db_raw %>%                                                                  #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total depreciation",                                 # Selecting and 
              Description %in% "Distribution and LV lines") %>%                           # Filtering 
              select(Year,                                                                # variable 1
                     rg_a_li_lv = Value),                                                 #

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total depreciation",                                 # Selecting and 
              Description %in% "Distribution and LV cables") %>%                          # Filtering 
              select(rg_a_cb_lv = Value),                                                 # variable 2

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total depreciation",                                 # Selecting and 
              Description %in% "Distribution substations and transformers") %>%           # Filtering 
              select(rg_a_sb_tr = Value),                                                 # variable 3

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total depreciation",                                 # Selecting and 
              Description %in% "Distribution switchgear") %>%                             # Filtering 
              select(rg_a_swi = Value),                                                   # variable 4

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total depreciation",                                 # Selecting and 
              Description %in% "Subtransmission lines") %>%                               # Filtering 
              select(rg_a_li_sb = Value),                                                 # variable 5

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total depreciation",                                 # Selecting and 
              Description %in% "Subtransmission cables") %>%                              # Filtering 
              select(rg_a_cb_sb = Value),                                                 # variable 6

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total depreciation",                                 # Selecting and 
              Description %in% "Non-network assets") %>%                                  # Filtering 
              select(rg_a_non_net = Value),                                               # variable 7

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total depreciation",                                 # Selecting and 
              Description %in% "Other network assets") %>%                                # Filtering 
              select(rg_a_net_ot = Value),                                                # variable 8

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total depreciation",                                 # Selecting and 
              Description %in% "Zone substations") %>%                                    # Filtering 
              select(rg_a_z_sub = Value),                                                 # variable 9

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total depreciation",                                 # Selecting and 
              Description %in% "Total") %>%                                               # Filtering 
              select(rg_a_rab_clo = Value)) %>%                                           # variable 10

# Plotting the table
kable( align = "c",                                                 # Align the table and content to center 
       caption = "<h4>Depreciation Segmentation</h4>",          # Table Title
       digits = 2,                                                  # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                        # 1. 
                     "Overhead",                    # 2.
                     "Underground",                 # 3. 
                     "Substation and Transformes",  # 4.
                     "Switchgear",                  # 5.
                     "Lines",                       # 6.
                     "Cables",                      # 7.
                     "Non Network",                 # 8.
                     "Other",                       # 9.
                     "Zone Substation",             # 10.
                     "Total")) %>%                  # 11.

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",    # Rows alterning color
                                          "hover")) %>%  # Responsive on mouse

              # Nest columns' header
              add_header_above(c(" " = 1,
                                 "Distribution and LV" = 4,
                                 "Subtransmission" = 2,
                                 "Network Assets" = 2,
                                 " " = 1,
                                 " " = 1))
```

### 2.6.5. Total Revaluation

Update the RAB based on the CPI4.

```{r,echo=FALSE}
# Creating a table of Total Revaluation
db_raw %>%                                                                                     #
       filter(EDB %in% "Aurora Energy",                                                                      #
              Section %in% "3(i): Regulatory Profit",                                                        # Creating table
              Description %in% c("Total revaluation",                                                        #
                                 "Total revaluations")) %>%                                                  #
              select(Year,rg_re = Value) %>% # Selecting the columns                                     #

                     arrange(-Year) -> au_rg_re # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable( au_rg_re,
                                   align = "c",  # Align the table and content to center 
                                   caption = "<h4>Total Revaluation</h4>",    # Table Title
                                   digits = 2,  # Round the number
                                   format.args = list(big.mark=","),                            # Thousand mark
                                   col.names = c("Year",                # Header Renaming
                                                 "[000 $]")) %>%        #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover"))      # Responsive on mouse
```

```{r graph-2-6-5,echo=FALSE}
# Bar plot with Descriptions Stacked
db_raw %>%                                                          #
       filter(EDB %in% "Aurora Energy",                             # Filtering
              Section %in% "4(vii): Disclosure by Asset Category",  #
              Subcategory %in% "Total revaluations",                #
              !Description %in% "Total") %>%   # Excluding Total    #

              mutate(Value = Value/1000) %>%   # Converting to Millions
       
                     select(Year,
                            Description,
                            Value) %>%
                     
                            # Plotting
                            ggplot(aes(x = Year,   # X Axis as Year
                                   y = Value,      # Y Axis $
                                   fill = Description)) +
                            # Bar Plot
                            geom_bar(stat = "identity") +
                            labs(x = "[Years]",
                                 y = "[Millions $]",
                                 title = "Revaluation Segmentation")
```

```{r,echo=FALSE}
## Revaluation Segmentation Table
bind_cols(    db_raw %>%                                                                  #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total revaluations",                                      # Selecting and 
              Description %in% "Distribution and LV lines") %>%                           # Filtering 
              select(Year,                                                                # variable 1
                     rg_a_li_lv = Value),                                                 #

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total revaluations",                                      # Selecting and 
              Description %in% "Distribution and LV cables") %>%                          # Filtering 
              select(rg_a_cb_lv = Value),                                                 # variable 2

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total revaluations",                                      # Selecting and 
              Description %in% "Distribution substations and transformers") %>%           # Filtering 
              select(rg_a_sb_tr = Value),                                                 # variable 3

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total revaluations",                                      # Selecting and 
              Description %in% "Distribution switchgear") %>%                             # Filtering 
              select(rg_a_swi = Value),                                                   # variable 4

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total revaluations",                                      # Selecting and 
              Description %in% "Subtransmission lines") %>%                               # Filtering 
              select(rg_a_li_sb = Value),                                                 # variable 5

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total revaluations",                                      # Selecting and 
              Description %in% "Subtransmission cables") %>%                              # Filtering 
              select(rg_a_cb_sb = Value),                                                 # variable 6

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total revaluations",                                      # Selecting and 
              Description %in% "Non-network assets") %>%                                  # Filtering 
              select(rg_a_non_net = Value),                                               # variable 7

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total revaluations",                                      # Selecting and 
              Description %in% "Other network assets") %>%                                # Filtering 
              select(rg_a_net_ot = Value),                                                # variable 8

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total revaluations",                                      # Selecting and 
              Description %in% "Zone substations") %>%                                    # Filtering 
              select(rg_a_z_sub = Value),                                                 # variable 9

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total revaluations",                                      # Selecting and 
              Description %in% "Total") %>%                                               # Filtering 
              select(rg_a_rab_clo = Value)) %>%                                           # variable 10

# Plotting the table
kable( align = "c",                                                 # Align the table and content to center 
       caption = "<h4>Revaluation Segmentation</h4>",               # Table Title
       digits = 2,                                                  # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                        # 1. 
                     "Overhead",                    # 2.
                     "Underground",                 # 3. 
                     "Substation and Transformes",  # 4.
                     "Switchgear",                  # 5.
                     "Lines",                       # 6.
                     "Cables",                      # 7.
                     "Non Network",                 # 8.
                     "Other",                       # 9.
                     "Zone Substation",             # 10.
                     "Total")) %>%                  # 11.

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",    # Rows alterning color
                                          "hover")) %>%  # Responsive on mouse

              # Nest columns' header
              add_header_above(c(" " = 1,
                                 "Distribution and LV" = 4,
                                 "Subtransmission" = 2,
                                 "Network Assets" = 2,
                                 " " = 1,
                                 " " = 1))
```

### 2.6.6. Operating Surplus

Operating Surplus = Total depreciation - Total revaluations + Regulatory profit / (loss) before tax

```{r,echo=FALSE}
# Creating a table of Operating Surplus
spread(data = db_raw %>%                                                                                     #
       filter(EDB %in% "Aurora Energy",                                                                      #
              Section %in% "3(i): Regulatory Profit",                                                        # Creating table
              Description %in% "Operating surplus / (deficit)") %>%                                           #
              select(Network,Year,r_dp = Value), # Selecting the columns                                     #
       key = Network,                                                                                        #
       value = r_dp) %>%                                                                                     #

                     arrange(-Year) %>% # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable( align = "c",  # Align the table and content to center 
                                   caption = "<h4>Operating Surplus</h4>",    # Table Title
                                   digits = 2,  # Round the number
                                   format.args = list(big.mark=","),                            # Thousand mark
                                   col.names = c("Year",                # Header Renaming
                                                 "[000 $]")) %>%        #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover"))      # Responsive on mouse
```

### 2.6.7.Pass-through and recoverable costs excluding financial incentives and wash-ups

```{r,echo=FALSE}
# Creating a table of Operating Surplus
spread(data = db_raw %>%                                                                                     #
       filter(EDB %in% "Aurora Energy",                                                                      #
              Section %in% "3(i): Regulatory Profit",                                                        # Creating table
              Description %in% c("Pass-through and recoverable costs",                                                   #
                                 "Pass-through and recoverable costs excluding financial incentives and wash-ups")) %>%  #
              select(Network,Year,r_dp = Value), # Selecting the columns                                                 #
       key = Network,                                                                                                    #
       value = r_dp) %>%                                                                                                 #

                     arrange(-Year) %>% # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable( align = "c",  # Align the table and content to center 
                                   caption = "<h4>Operating Surplus</h4>",    # Table Title
                                   digits = 2,  # Round the number
                                   format.args = list(big.mark=","),                            # Thousand mark
                                   col.names = c("Year",                # Header Renaming
                                                 "[000 $]")) %>%        #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover"))      # Responsive on mouse
```

#### 2.6.7.1. Electricity lines service charge payable to Transpower

```{r,echo=FALSE}
# Creating a table of Electricity lines service charge payable to Transpower
spread(data = db_raw %>%                                                                                        #
       filter(EDB %in% "Aurora Energy",                                                                         #
              Section %in% c("3(ii): Pass-through and Recoverable Costs excluding Financial Incentives and Wash-Ups",#
                             "3(ii): Pass-Through and Recoverable Costs"),                                      # Creating table
              Description %in% c("Electricity lines service charge payable to Transpower",                      #
                                 "Non-exempt EDB electricity lines service charge payable to Transpower")) %>%  #
              select(Network,Year,r_dp = Value), # Selecting the columns                                        #
       key = Network,                                                                                           #
       value = r_dp) %>%                                                                                        #

                     arrange(-Year) %>% # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable( align = "c",  # Align the table and content to center 
                                   caption = "<h4>Transpower Charge</h4>",    # Table Title
                                   digits = 2,  # Round the number
                                   format.args = list(big.mark=","),                            # Thousand mark
                                   col.names = c("Year",                # Header Renaming
                                                 "[000 $]")) %>%        #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover"))      # Responsive on mouse
```

#### 2.6.7.2. Distributed Generation Allowance or Avoided Transmission Charge

```{r,echo=FALSE}
# Creating a table of Distributed Generation Allowance or Avoided Transmission Charge
spread(data = db_raw %>%                                                                                        #
       filter(EDB %in% "Aurora Energy",                                                                         #
              Section %in% c("3(ii): Pass-through and Recoverable Costs excluding Financial Incentives and Wash-Ups",#
                             "3(ii): Pass-Through and Recoverable Costs"),                                      # Creating table
              Description %in% c("Avoided transmission charge",                                                 #
                                 "Distributed generation allowance")) %>%                                       #
              select(Network,Year,r_dp = Value), # Selecting the columns                                        #
       key = Network,                                                                                           #
       value = r_dp) %>%                                                                                        #

                     arrange(-Year) %>% # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable( align = "c",  # Align the table and content to center 
                                   caption = "<h4>DG Allowance or Avoided Transmission Charge Charge</h4>",    # Table Title
                                   digits = 2,  # Round the number
                                   col.names = c("Year",                # Header Renaming
                                                 "[000 $]")) %>%        #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover"))      # Responsive on mouse
```

#### 2.6.7.3. Other recoverable costs excluding financial incentives and wash-ups

```{r,echo=FALSE}
# Creating a table of Other recoverable costs excluding financial incentives and wash-ups
spread(data = db_raw %>%                                                                                        #
       filter(EDB %in% "Aurora Energy",                                                                         #
              Section %in% c("3(ii): Pass-through and Recoverable Costs excluding Financial Incentives and Wash-Ups",#
                             "3(ii): Pass-Through and Recoverable Costs"),                                      # Creating table
              Description %in% c("Other specified pass-through costs",                                          #
                                 "Other recoverable costs excluding financial incentives and wash-ups")) %>%    #
              select(Network,Year,r_dp = Value), # Selecting the columns                                        #
       key = Network,                                                                                           #
       value = r_dp) %>%                                                                                        #

                     arrange(-Year) %>% # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable( align = "c",  # Align the table and content to center 
                                   caption = "<h4>Other recoverable costs excluding financial incentives and wash-ups</h4>",    # Table Title
                                   digits = 2,  # Round the number
                                   format.args = list(big.mark=","),                            # Thousand mark
                                   col.names = c("Year",                # Header Renaming
                                                 "[000 $]")) %>%        #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover"))      # Responsive on mouse
```

#### 2.6.7.4. Rates, Tax, and Levies

```{r,echo=FALSE}
bind_cols(    db_raw %>%                                                                                        #
       filter(EDB %in% "Aurora Energy",                                                                         #
              Section %in% c("3(ii): Pass-through and Recoverable Costs excluding Financial Incentives and Wash-Ups",#
                            "3(ii): Pass-Through and Recoverable Costs"),                                      # Creating table
              Description %in% "Rates") %>%
              select(Year,r_rate = Value),

db_raw %>%                                                                                        #
       filter(EDB %in% "Aurora Energy",                                                                         #
              Section %in% c("3(ii): Pass-through and Recoverable Costs excluding Financial Incentives and Wash-Ups",#
                             "3(ii): Pass-Through and Recoverable Costs"),                                      # Creating table
              Description %in% "Commerce Act levies") %>%
              select(r_levies = Value),

db_raw %>%                                                                                        #
       filter(EDB %in% "Aurora Energy",                                                                         #
              Section %in% c("3(ii): Pass-through and Recoverable Costs excluding Financial Incentives and Wash-Ups",#
                             "3(ii): Pass-Through and Recoverable Costs"),                                      # Creating table
              Description %in% c("Electricity Authority levies",
                                 "Industry levies")) %>%
              select(r_eal = Value) ) %>%
                     mutate(r_tax = r_rate + r_levies + r_eal) %>%

                            # Plotting the table
                            kable( align = "c",  # Align the table and content to center 
                                   caption = "<h4>Other recoverable costs excluding financial incentives and wash-ups</h4>",    # Table Title
                                   digits = 2,  # Round the number
                                   format.args = list(big.mark=","),                            # Thousand mark
                                   col.names = c("Year",                # Header Renaming
                                                 "Rate (1)",
                                                 "Indutrial (2)",
                                                 "Electricity Authority (3)",
                                                 "Total [000 $] (1)+(2)+(3)")) %>%        #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse
                                          add_header_above(c(" " = 1,                       #
                                                             "Levies or Rates [000 $]" = 3, # Nest columns' header to a "parent"
                                                             " " = 1))                      #
```

### 2.6.8. Operation Expenditure/Operating Cost Allocations

```{r,echo=FALSE}
# Creating a table of Operational Expenditure
db_raw %>%                                                                                     #
       filter(EDB %in% "Aurora Energy",                                                                      #
              Section %in% "3(i): Regulatory Profit",                                                        #
              Description %in% "Operational expenditure") %>%                                                    #Creating table
              select(Year,r_opex = Value) %>% # Selecting the columns                                     #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Operational Expenditure</h4>",    # Table Title
                                   digits = 2,  # Round the number
                                   format.args = list(big.mark=","),                            # Thousand mark
                                   col.names = c("Year",                # Header Renaming
                                                 "[000 $]")) %>%        #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover"))      # Responsive on mouse
```

```{r,echo=FALSE}
## Operating Cost Allocations Table
bind_cols(    db_raw %>%                                                                  #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "5d(i): Operating Cost Allocations",                           #
              Subcategory %in% "Total attributable to regulated service",                 # Selecting and 
              Category %in% "Asset replacement and renewal") %>%                          # Filtering 
              select(Year,                                                                # variable 1 and 2
                     rg_a_op_rep_ren = Value),                                            #

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "5d(i): Operating Cost Allocations",                           #
              Subcategory %in% "Total attributable to regulated service",                 # Selecting and 
              Category %in% "System operations and network support") %>%                  # Filtering 
              select(rg_a_op_supor = Value),                                              # variable 3

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "5d(i): Operating Cost Allocations",                           #
              Subcategory %in% "Total attributable to regulated service",                 # Selecting and 
              Category %in% "Business support") %>%                                       # Filtering 
              select(rg_a_op_bus_supor = Value),                                          # variable 4

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "5d(i): Operating Cost Allocations",                           #
              Subcategory %in% "Total attributable to regulated service",                 # Selecting and 
              Category %in% "Service interruptions and emergencies") %>%                  # Filtering 
              select(rg_a_op_emerg = Value),                                              # variable 5
       
db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "5d(i): Operating Cost Allocations",                           #
              Subcategory %in% "Total attributable to regulated service",                 # Selecting and 
              Category %in% "Vegetation management") %>%                                  # Filtering 
              select(rg_a_op_veg_mana = Value),                                           # variable 6
       
db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "5d(i): Operating Cost Allocations",                           #
              Subcategory %in% "Total attributable to regulated service",                 # Selecting and 
              Category %in% "Routine and corrective maintenance and inspection") %>%      # Filtering 
              select(rg_a_op_veg_mana = Value),                                           # variable 7

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "5d(i): Operating Cost Allocations",                           #
              Subcategory %in% "Total attributable to regulated service",                 # Selecting and 
              Category %in% "Total operating costs") %>%                                  # Filtering 
              select(rg_a_op_cost_tot = Value)) %>%                                       # variable 7
       
       
       
       
# Plotting the table
kable( align = "c",                                                 # Align the table and content to center 
       caption = "<h4>Operating Cost Allocations</h4>",             # Table Title
       digits = 2,                                                  # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                                   # 1. 
                     "Replacement and Renewal",                # 2.
                     "System Operation and Network Support",   # 3. 
                     "Business Support",                       # 4.
                     "Service interruptions and emergencies",  # 5
                     "Vegetation management",                  # 6.
                     "Routine and corrective maintenance and inspection", # 7.
                     "Total Operating Cost")) %>%              # 8.

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",    # Rows alterning color
                                          "hover"))      # Responsive on mouse
```

```{r graph-2-6-8,echo=FALSE}
# Operating Cost Allocations Bar plot
db_raw %>%                                                                #
       filter(EDB %in% "Aurora Energy",                                   # Filtering
              Section %in% "5d(i): Operating Cost Allocations",           #
              Subcategory %in% "Total attributable to regulated service", #
              !Category %in% "Total operating costs") %>%   # Excluding Total          #

              mutate(Value = Value/1000) %>%   # Converting to Millions
       
                     select(Year,
                            Category,
                            Value) %>%
                     
                            # Plotting
                            ggplot(aes(x = Year,   # X Axis as Year
                                   y = Value,      # Y Axis $
                                   fill = Category)) +
                            # Bar Plot
                            geom_bar(stat = "identity") +
                            labs(x = "[Years]",
                                 y = "[Millions $]",
                                 title = "Operating Cost Allocations")
```

From the graph 2.6.8. is possible to see a increasing costs in Vegetation Management and in routine/corretive maintenance/inspection.

#### 2.6.8.1. Network Opex

```{r,echo=FALSE}
## Asset Relocations Segmentation Table
bind_cols(db_raw %>%                                                                      #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6b(i): Operational Expenditure",                              # Selecting and
              Description %in% "Service interruptions and emergencies") %>%               #
              select(Year,                                                                # Variable 1 and 2
                     rg_r_exp_rel_tot = Value),                                           #

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6b(i): Operational Expenditure",                              # Selecting and
              Description %in% "Vegetation management") %>%                               # Filtering 
              select(rg_r_exp_rel_tot = Value),                                           # Variable 3

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6b(i): Operational Expenditure",                              # Selecting and
              Description %in% "Routine and corrective maintenance and inspection") %>%   # Filtering 
              select(rg_r_exp_rel_tot = Value),                                           # Variable 4

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6b(i): Operational Expenditure",                              # Selecting and
              Description %in% "Asset replacement and renewal") %>%                       # Filtering 
              select(rg_r_exp_rel_tot = Value),                                           # Variable 5

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6b(i): Operational Expenditure",                              # Selecting and
              Description %in% "Network opex") %>%                                        # Filtering 
              select(rg_r_exp_rel_tot = Value)) %>%                                       # Variable 6

# Plotting the table
kable( align = "c",                                               # Align the table and content to center 
       caption = "<h4>Network opex</h4>",  # Table Title
       digits = 2,                                                # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                                              # 1.
                     "Service interruptions and emergencies",             # 2.
                     "Vegetation management",                             # 3. Header Renaming
                     "Routine and corrective maintenance and inspection", # 4.
                     "Asset replacement and renewal",                     # 5.
                     "Network opex")) %>%                                 # 6. 

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                          "hover"))       # Responsive on mouse
```

```{r graph-2-6-8-1,echo=FALSE}
# Operating Cost Allocations Bar plot
db_raw %>%                                                                #
       filter(EDB %in% "Aurora Energy",                                   # Filtering
              Section %in% "6b(i): Operational Expenditure",           #
              !Category %in% "Network opex") %>%   # Excluding Total          #

              mutate(Value = Value/1000) %>%   # Converting to Millions
       
                     select(Year,
                            Description,
                            Value) %>%
                     
                            # Plotting
                            ggplot(aes(x = Year,   # X Axis as Year
                                   y = Value,      # Y Axis $
                                   fill = Description)) +
                            # Bar Plot
                            geom_bar(stat = "identity") +
                            labs(x = "[Years]",
                                 y = "[Millions $]",
                                 title = "Network Opex")
```

#### 2.6.8.2. Non-network Opex

```{r echo=FALSE}
## Asset Relocations Segmentation Table
bind_cols(db_raw %>%                                                                      #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6b(i): Operational Expenditure",                              # Selecting and
              Description %in% "System operations and network support") %>%               #
              select(Year,                                                                # Variable 1 and 2
                     rg_r_exp_rel_tot = Value),                                           #

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6b(i): Operational Expenditure",                              # Selecting and
              Description %in% "Business support") %>%                               # Filtering 
              select(rg_r_exp_rel_tot = Value),                                           # Variable 3

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6b(i): Operational Expenditure",                              # Selecting and
              Description %in% "Non-network opex") %>%   # Filtering 
              select(rg_r_exp_rel_tot = Value)) %>%                                       # Variable 4

# Plotting the table
kable( align = "c",                                               # Align the table and content to center 
       caption = "<h4>Non-network Opex</h4>",  # Table Title
       digits = 2,                                                # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                                              # 1.
                     "System operations and network support",             # 2.
                     "Business support",                             # 3. Header Renaming
                     "Non-network opex")) %>%                                 # 4. 

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                          "hover"))       # Responsive on mouse
```

```{r graph-2-6-8-2,echo=FALSE}
# Operating Cost Allocations Bar plot
db_raw %>%                                                                #
       filter(EDB %in% "Aurora Energy",                                   # Filtering
              Section %in% "6b(i): Operational Expenditure",           #
              !Category %in% "Non-network opex") %>%   # Excluding Total          #

              mutate(Value = Value/1000) %>%   # Converting to Millions
       
                     select(Year,
                            Description,
                            Value) %>%
                     
                            # Plotting
                            ggplot(aes(x = Year,   # X Axis as Year
                                   y = Value,      # Y Axis $
                                   fill = Description)) +
                            # Bar Plot
                            geom_bar(stat = "identity") +
                            labs(x = "[Years]",
                                 y = "[Millions $]",
                                 title = "Non-network Opex")
```

#### 2.6.8.3. Insurance

```{r echo=FALSE}
db_raw %>%    filter(EDB %in% "Aurora Energy",
                     Section %in% "6b(ii): Subcomponents of Operational Expenditure (where known)",
                     Description %in% "Insurance") %>%
                     select(Year,
                            Insurance = Value) %>%
# Plotting the table
kable( align = "c",                                               # Align the table and content to center 
       caption = "<h4>Insurance</h4>",  # Table Title
       digits = 2,                                                # Round the number
       format.args = list(big.mark=",")) %>%                            # Thousand mark

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                          "hover"))       # Responsive on mouse



```

### 2.6.9. Lines Charge

Total regulatory income = Line charge revenue + Other regulated income (other than gains / (losses) on asset disposals) + Gains / (losses) on asset disposals

```{r,echo=FALSE}
# Creating a table of Lines Charge
spread(data = db_raw %>%                                                                                     #
       filter(EDB %in% "Aurora Energy",                                                                      #
              Section %in% "3(i): Regulatory Profit",                                                        #
              Description %in% "Line charge revenue") %>%                                                    #Creating table
              select(Network,Year,r_li_ch = Value), # Selecting the columns                                     #
       key = Network,                                                                                        #
       value = r_li_ch) %>%                                                                                     #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Lines Charge</h4>",    # Table Title
                                   digits = 2,  # Round the number
                                   format.args = list(big.mark=","),                            # Thousand mark
                                   col.names = c("Year",                # Header Renaming
                                                 "[000 $]")) %>%        #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover"))      # Responsive on mouse
```

### 2.6.10. Other regulated income (other than gains / (losses) on asset disposals)

```{r,echo=FALSE}
# Creating a table of Other regulated income (other than gains / (losses) on asset disposals)
spread(data = db_raw %>%                                                                                       #
       filter(EDB %in% "Aurora Energy",                                                                        # Creating table
              Section %in% "3(i): Regulatory Profit",                                                          #
              Description %in% "Other regulated income (other than gains / (losses) on asset disposals)") %>%  #
              select(Network,Year,r_opex = Value), # Selecting the columns                                     #
       key = Network,                                                                                          #
       value = r_opex) %>%                                                                                     #

                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Other regulated income (other than gains / (losses) on asset disposals)</h4>",    # Table Title
                                   digits = 2,  # Round the number
                                   format.args = list(big.mark=","),                            # Thousand mark
                                   col.names = c("Year",                # Header Renaming
                                                 "[000 $]")) %>%        #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover"))      # Responsive on mouse
```

### 2.6.11. Total Regulatory Income

```{r,echo=FALSE}
# Creating a table of Total Regulatory Income
db_raw %>%                                                    #
       filter(EDB %in% "Aurora Energy",                                     # Creating table
              Section %in% "3(i): Regulatory Profit",                       #
              Description %in% "Total regulatory income") %>%               #
              select(Year,rg_a_inc = Value) %>%  # Selecting the columns  #
                                                 #
                     arrange(-Year) %>%  # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable(align = "c",  # Align the table and content to center 
                                   caption = "<h4>Total Regulatory Income</h4>",    # Table Title
                                   digits = 2,  # Round the number
                                   format.args = list(big.mark=","),
                                   col.names = c("Year",                # Header Renaming
                                                 "[000 $]")) %>%        #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover"))      # Responsive on mouse
```

## 2.7. Regulatory Asset Base (RAB)

Total opening RAB value = Total opening RAB value + Assets commissioned + Asset disposals + Total revaluations - Total depreciation + Adjustment

### 2.7.1. RAB Opening Year

Acummulated RAB over past years.

```{r,echo=FALSE}
# Creating a table of Opening RAB
db_raw %>%                                                           #
       filter(EDB %in% "Aurora Energy",                                            # Creating table
              Section %in% "4(ii): Unallocated Regulatory Asset Base",             #
              Subcategory %in% "RAB",                                              #
              Description %in% "Total opening RAB value") %>%                      #
              select(Year,rg_rab_ac = Value) %>%   # Selecting the columns         #

                     arrange(-Year) -> au_rg_rab_ac # Ordering by years (2017 to 2013)
       
                            # Plotting the table
                            kable( au_rg_rab_ac,
                                   align = "c",  # Align the table and content to center 
                                   caption = "<h4>Opening RAB</h4>",    # Table Title
                                   digits = 2,  # Round the number
                                   format.args = list(big.mark=","),    # Thousand mark
                                   col.names = c("Year",                # Header Renaming
                                                 "[000 $]")) %>%        #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover"))      # Responsive on mouse
```

```{r graph-2-7-1,echo=FALSE}
# Bar plot with Descriptions Stacked
db_raw %>%                                                          #
       filter(EDB %in% "Aurora Energy",                             # Filtering
              Section %in% "4(vii): Disclosure by Asset Category",  #
              Subcategory %in% "Total opening RAB value",           #
              !Description %in% "Total") %>%   # Excluding Total    #

              mutate(Value = Value/1000) %>%   # Converting to Millions
       
                     select(Year,
                            Description,
                            Value) %>%
                     
                            # Plotting
                            ggplot(aes(x = Year,   # X Axis as Year
                                   y = Value,      # Y Axis $
                                   fill = Description)) +
                            # Bar Plot
                            geom_bar(stat = "identity") +
                            labs(x = "[Years]",
                                 y = "[Millions $]",
                                 title = "Opening Year RAB Segmentation")
```

```{r,echo=FALSE}
## Opening RAB Segmentation
bind_cols(    db_raw %>%                                                                  #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total opening RAB value",                                     # Selecting and 
              Description %in% "Distribution and LV lines") %>%                           # Filtering 
              select(Year,                                                                # variable 1
                     rg_a_li_lv = Value),                                                 #

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total opening RAB value",                                     # Selecting and 
              Description %in% "Distribution and LV cables") %>%                          # Filtering 
              select(rg_a_cb_lv = Value),                                                 # variable 2

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total opening RAB value",                                     # Selecting and 
              Description %in% "Distribution substations and transformers") %>%           # Filtering 
              select(rg_a_sb_tr = Value),                                                 # variable 3

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total opening RAB value",                                     # Selecting and 
              Description %in% "Distribution switchgear") %>%                             # Filtering 
              select(rg_a_swi = Value),                                                   # variable 4

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total opening RAB value",                                     # Selecting and 
              Description %in% "Subtransmission lines") %>%                               # Filtering 
              select(rg_a_li_sb = Value),                                                 # variable 5

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total opening RAB value",                                     # Selecting and 
              Description %in% "Subtransmission cables") %>%                              # Filtering 
              select(rg_a_cb_sb = Value),                                                 # variable 6

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total opening RAB value",                                     # Selecting and 
              Description %in% "Non-network assets") %>%                                  # Filtering 
              select(rg_a_non_net = Value),                                               # variable 7

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total opening RAB value",                                     # Selecting and 
              Description %in% "Other network assets") %>%                                # Filtering 
              select(rg_a_net_ot = Value),                                                # variable 8

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total opening RAB value",                                     # Selecting and 
              Description %in% "Zone substations") %>%                                    # Filtering 
              select(rg_a_z_sub = Value),                                                 # variable 9

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total opening RAB value",                                     # Selecting and 
              Description %in% "Total") %>%                                               # Filtering 
              select(rg_a_rab_clo = Value)) %>%                                           # variable 10

# Plotting the table
kable( align = "c",                                                 # Align the table and content to center 
       caption = "<h4>Opening RAB Segmentation</h4>",        # Table Title
       digits = 2,                                                  # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                        # 1. 
                     "Overhead",                    # 2.
                     "Underground",                 # 3. 
                     "Substation and Transformes",  # 4.
                     "Switchgear",                  # 5.
                     "Lines",                       # 6.
                     "Cables",                      # 7.
                     "Non Network",                 # 8.
                     "Other",                       # 9.
                     "Zone Substation",             # 10.
                     "Total")) %>%                  # 11.

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",    # Rows alterning color
                                          "hover")) %>%  # Responsive on mouse

              # Nest columns' header
              add_header_above(c(" " = 1,
                                 "Distribution and LV" = 4,
                                 "Subtransmission" = 2,
                                 "Network Assets" = 2,
                                 " " = 1,
                                 " " = 1))
```

### 2.7.2. Assets Commissioned

Assets commissioned = Assets acquired from a related party + Assets acquired from a regulated supplier + Assets commissioned (other than below)

```{r,echo=FALSE}
## Assets Commisioned Table
bind_cols(    db_raw %>%                                                                  #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(ii): Unallocated Regulatory Asset Base",                    #
              Subcategory %in% "RAB",                                                     # Selecting and 
              Description %in% "Assets commissioned (other than below)") %>%              # Filtering 
              select(Year,rg_a_com_ot = Value),                                            # variable 1

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(ii): Unallocated Regulatory Asset Base",                    #
              Subcategory %in% "RAB",                                                     # Selecting and 
              Description %in% "Assets acquired from a regulated supplier") %>%           # Filtering
              select(Year,rg_a_acq_sup = Value),                                           # variable 2

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(ii): Unallocated Regulatory Asset Base",                    #
              Subcategory %in% "RAB",                                                     # Selecting and
              Description %in% "Assets acquired from a related party") %>%                # Filtering
              select(Year,rg_a_acq_rp = Value)) %>%                                        # variable 3
       
                     mutate(rg_a_com = rg_a_com_ot + rg_a_acq_sup + rg_a_acq_rp) %>%  # Creating the "total" column
                            
                            select(Year,                      #
                                   rg_a_acq_sup,              #
                                   rg_a_acq_rp,               # Columns Ordering
                                   rg_a_com_ot,               #          
                                   rg_a_com) -> au_rg_a_com   #
       
                            # Plotting the table
                            kable( au_rg_a_com,
                                   align = "c",                                    # Align the table and content to center 
                                   caption = "<h4>Assets Commissioned</h4>",       # Table Title
                                   digits = 2,                                     # Round the number
                                   col.names = c("Year",                        # 
                                                 "Regulated Suppliers [000 $]", #
                                                 "Third Parties [000 $]",       # Header Renaming
                                                 "Other [000 $]",               #
                                                 "Total [000 $]")) %>%          #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse

                                          add_header_above(c(" " = 1,                            #
                                                             "Acquired Assets Commissioned" = 2, # Nest columns' header
                                                             " " = 1,                            # to a "parent"
                                                             " " = 1))                           #
```

```{r graph-2-7-2,echo=FALSE}
# Assets Commossioned Bar plot
db_raw %>%                                                          #
       filter(EDB %in% "Aurora Energy",                             # Filtering
              Section %in% "4(vii): Disclosure by Asset Category",  #
              Subcategory %in% "Assets commissioned",           #
              !Description %in% "Total") %>%   # Excluding Total    #

              mutate(Value = Value/1000) %>%   # Converting to Millions
       
                     select(Year,
                            Description,
                            Value) %>%
                     
                            # Plotting
                            ggplot(aes(x = Year,   # X Axis as Year
                                   y = Value,      # Y Axis $
                                   fill = Description)) +
                            # Bar Plot
                            geom_bar(stat = "identity") +
                            labs(x = "[Years]",
                                 y = "[Millions $]",
                                 title = "Assets Commissioned Segmentation")
```

```{r,echo=FALSE}
## RAB Adjustment Table
bind_cols(    db_raw %>%                                                                  #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Assets commissioned",                                     # Selecting and 
              Description %in% "Distribution and LV lines") %>%                           # Filtering 
              select(Year,                                                                # variable 1
                     rg_a_li_lv = Value),                                                 #

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Assets commissioned",                                     # Selecting and 
              Description %in% "Distribution and LV cables") %>%                          # Filtering 
              select(rg_a_cb_lv = Value),                                                 # variable 2

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Assets commissioned",                                     # Selecting and 
              Description %in% "Distribution substations and transformers") %>%           # Filtering 
              select(rg_a_sb_tr = Value),                                                 # variable 3

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Assets commissioned",                                     # Selecting and 
              Description %in% "Distribution switchgear") %>%                             # Filtering 
              select(rg_a_swi = Value),                                                   # variable 4

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Assets commissioned",                                     # Selecting and 
              Description %in% "Subtransmission lines") %>%                               # Filtering 
              select(rg_a_li_sb = Value),                                                 # variable 5

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Assets commissioned",                                     # Selecting and 
              Description %in% "Subtransmission cables") %>%                              # Filtering 
              select(rg_a_cb_sb = Value),                                                 # variable 6

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Assets commissioned",                                     # Selecting and 
              Description %in% "Non-network assets") %>%                                  # Filtering 
              select(rg_a_non_net = Value),                                               # variable 7

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Assets commissioned",                                     # Selecting and 
              Description %in% "Other network assets") %>%                                # Filtering 
              select(rg_a_net_ot = Value),                                                # variable 8

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Assets commissioned",                                     # Selecting and 
              Description %in% "Zone substations") %>%                                    # Filtering 
              select(rg_a_z_sub = Value),                                                 # variable 9

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Assets commissioned",                                     # Selecting and 
              Description %in% "Total") %>%                                               # Filtering 
              select(rg_a_rab_clo = Value)) %>%                                           # variable 10

# Plotting the table
kable( align = "c",                                                 # Align the table and content to center 
       caption = "<h4>Asset Commissioned Segmentation</h4>",        # Table Title
       digits = 2,                                                  # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                        # 1. 
                     "Overhead",                    # 2.
                     "Underground",                 # 3. 
                     "Substation and Transformes",  # 4.
                     "Switchgear",                  # 5.
                     "Lines",                       # 6.
                     "Cables",                      # 7.
                     "Non Network",                 # 8.
                     "Other",                       # 9.
                     "Zone Substation",             # 10.
                     "Total")) %>%                  # 11.

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",    # Rows alterning color
                                          "hover")) %>%  # Responsive on mouse

              # Nest columns' header
              add_header_above(c(" " = 1,
                                 "Distribution and LV" = 4,
                                 "Subtransmission" = 2,
                                 "Network Assets" = 2,
                                 " " = 1,
                                 " " = 1))
```

## 2.7.3. Non-Network Assets

```{r echo=FALSE}
## Filtering and Selecting the info to create a table about Atypical expenditure in Non-network Assets
db_raw %>%    filter(EDB %in% "Aurora Energy",
                     Section %in% "6a(ix): Non-Network Assets",
                     Subcategory %in% "Atypical expenditure",
                     Year %in% 2018) %>%
                     select(Description,
                            Year,
                            "[000 $]" = Value) %>%

# Plotting the table
kable( align = "c",                                               # Align the table and content to center 
       caption = "<h4>Atypical expenditure in Non-Network Assets</h4>",  # Table Title
       digits = 2,                                                # Round the number
       format.args = list(big.mark=",")) %>%                            # Thousand mark                                   # 9. 
       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                          "hover"))       # Responsive on mouse

```

### 2.7.3. Assets Disposal

Asset disposals = Asset disposals (other than below) + Asset disposals to a regulated supplier + Asset disposals to a related party

```{r,echo=FALSE}
## Assets Disposal Table
bind_cols(    db_raw %>%                                                                  #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(ii): Unallocated Regulatory Asset Base",                    #
              Subcategory %in% "RAB",                                                     # Selecting and 
              Description %in% "Asset disposals (other than below)") %>%                  # Filtering 
              select(Year,rg_a_dis_ot = Value),                                            # variable 1

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(ii): Unallocated Regulatory Asset Base",                    #
              Subcategory %in% "RAB",                                                     # Selecting and 
              Description %in% "Asset disposals to a regulated supplier") %>%             # Filtering
              select(Year,rg_a_dis_sup = Value),                                           # variable 2

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(ii): Unallocated Regulatory Asset Base",                    #
              Subcategory %in% "RAB",                                                     # Selecting and
              Description %in% "Asset disposals to a related party") %>%                # Filtering
              select(Year,rg_a_dis_rp = Value)) %>%                                        # variable 3
       
                     mutate(rg_a_dis = rg_a_dis_ot + rg_a_dis_sup + rg_a_dis_rp) %>%  # Creating the "total" column
                            
                            select(Year,                      #
                                   rg_a_dis_sup,              #
                                   rg_a_dis_rp,               # Columns Ordering
                                   rg_a_dis_ot,               #
                                   rg_a_dis) -> au_rg_a_dis   #
       
                            # Plotting the table
                            kable( au_rg_a_dis,
                                   align = "c",                                    # Align the table and content to center 
                                   caption = "<h4>Assets Disposal</h4>",           # Table Title
                                   digits = 2,                                     # Round the number
                                   format.args = list(big.mark=","),                            # Thousand mark
                                   col.names = c("Year",                        # 
                                                 "Regulated Suppliers [000 $]", #
                                                 "Related Parties [000 $]",     # Header Renaming
                                                 "Other [000 $]",               #
                                                 "Total [000 $]")) %>%          #

                                   # Adding style to look nice
                                   kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                                       "hover")) %>%  # Responsive on mouse

                                          add_header_above(c(" " = 1,                            #
                                                             "Assets Disposal" = 2,              # Nest columns' header
                                                             " " = 1,                            # to a "parent"
                                                             " " = 1))                           #
```

### 2.7.4. Adjustments

Adjustments = Lost and found assets adjustment + Adjustment resulting from asset allocation

```{r,echo=FALSE}
## RAB Adjustment Table
bind_cols(    db_raw %>%                                                                  #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(ii): Unallocated Regulatory Asset Base",                    #
              Subcategory %in% "RAB",                                                     # Selecting and 
              Description %in% "Lost and found assets adjustment") %>%                    # Filtering 
              select(Year,rg_a_adj_lf = Value),                                            # variable 1

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(ii): Unallocated Regulatory Asset Base",                    #
              Subcategory %in% "RAB",                                                     # Selecting and
              Description %in% "Adjustment resulting from asset allocation") %>%          # Filtering
              select(Year,rg_a_adj_aln = Value)) %>%                                        # variable 2
       
                     mutate(rg_a_adj = rg_a_adj_lf + rg_a_adj_aln) %>%  # Creating the "total" column
                            
                            select(Year,                     #
                                   rg_a_adj_lf,              #
                                   rg_a_adj_aln,             # Columns Ordering
                                   rg_a_adj) -> au_rg_adj    #
       
# Plotting the table
kable( au_rg_adj,
       align = "c",                                    # Align the table and content to center 
       caption = "<h4>RAB Adjustment</h4>",            # Table Title
       digits = 2,                                     # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                        # 
                     "Lost and Found [000 $]",      #
                     "Allocation [000 $]",          # Header Renaming
                     "Total [000 $]")) %>%          #

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                          "hover")) %>%  # Responsive on mouse

              # Nest columns' header
              add_header_above(c(" " = 1,
                                   "Adjustment" = 2,
                                   " " = 1))
```

### 2.7.5. Regulatory Asset Base Closing Year

```{r,echo=FALSE}
# Creating a table of Regulatory Asset Base
bind_cols(Year = au_rg_rab_ac$Year,               # 1. Year
          rg_rab_ac = au_rg_rab_ac$rg_rab_ac,     # 2. RAB Accummulated             
          rg_a_com = au_rg_a_com$rg_a_com,        # 3. Asset Commissioned
          rg_a_dis = au_rg_a_dis$rg_a_dis,        # 4. Asset Disposal
          rg_a_adj = au_rg_adj$rg_a_adj,          # 5. Adjustment
          au_rg_dp = au_rg_dp$rg_dp[1:6],         # 6. Depreciation
          au_rg_re = au_rg_re$rg_re[1:6]) %>%     # 7. Revaluation
       
       mutate(RAB = rg_rab_ac + rg_a_com + rg_a_adj + au_rg_re - au_rg_dp - rg_a_dis) %>%
              select(Year,       # 1.
                     rg_rab_ac,  # 2.
                     rg_a_com,   # 3.
                     au_rg_re,   # 4.
                     au_rg_dp,   # 5.
                     rg_a_dis,   # 6.
                     rg_a_adj,   # 7.
                     RAB) %>%    # 8.

                     # Plotting the table
                     kable( align = "c",  # Align the table and content to center 
                            caption = "<h4>Regulatory Asset Base (in the end of Year)</h4>",    # Table Title
                            digits = 2,  # Round the number
                            format.args = list(big.mark=","),    # Thousand mark
                            col.names = c("Year",                # Header Renaming
                                          "(+) RAB in January",
                                          "(+) Asset Commissioned",
                                          "(+) Revaluation",
                                          "(-) Depreciation",
                                          "(-) Asset Disposal",
                                          "(+) Adjustments",
                                          "(=) RAB in December")) %>%        #

                            # Adding style to look nice
                            kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                                               "hover"))       # Responsive on mouse
```

```{r graph-2-7-5,echo=FALSE}
# Bar plot with Descriptions Stacked
db_raw %>%                                                          #
       filter(EDB %in% "Aurora Energy",                             # Filtering
              Section %in% "4(vii): Disclosure by Asset Category",  #
              Subcategory %in% "Total closing RAB value",           #
              !Description %in% "Total") %>%   # Excluding Total    #

              mutate(Value = Value/1000) %>%   # Converting to Millions
       
                     select(Year,
                            Description,
                            Value) %>%
                     
                            # Plotting
                            ggplot(aes(x = Year,   # X Axis as Year
                                   y = Value,      # Y Axis $
                                   fill = Description)) +
                            # Bar Plot
                            geom_bar(stat = "identity") + 
                            labs(x = "[Years]",
                                 y = "[Millions $]",
                                 title = "Closing Year RAB Segmentation")
```

```{r,echo=FALSE}
## RAB Adjustment Table
bind_cols(    db_raw %>%                                                                  #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total closing RAB value",                                 # Selecting and 
              Description %in% "Distribution and LV lines") %>%                           # Filtering 
              select(Year,                                                                # variable 1
                     rg_a_li_lv = Value),                                                 #

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total closing RAB value",                                 # Selecting and 
              Description %in% "Distribution and LV cables") %>%                          # Filtering 
              select(rg_a_cb_lv = Value),                                                 # variable 2

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total closing RAB value",                                 # Selecting and 
              Description %in% "Distribution substations and transformers") %>%           # Filtering 
              select(rg_a_sb_tr = Value),                                                 # variable 3

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total closing RAB value",                                 # Selecting and 
              Description %in% "Distribution switchgear") %>%                             # Filtering 
              select(rg_a_swi = Value),                                                   # variable 4

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total closing RAB value",                                 # Selecting and 
              Description %in% "Subtransmission lines") %>%                               # Filtering 
              select(rg_a_li_sb = Value),                                                 # variable 5

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total closing RAB value",                                 # Selecting and 
              Description %in% "Subtransmission cables") %>%                              # Filtering 
              select(rg_a_cb_sb = Value),                                                 # variable 6

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total closing RAB value",                                 # Selecting and 
              Description %in% "Non-network assets") %>%                                  # Filtering 
              select(rg_a_non_net = Value),                                               # variable 7

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total closing RAB value",                                 # Selecting and 
              Description %in% "Other network assets") %>%                                # Filtering 
              select(rg_a_net_ot = Value),                                                # variable 8

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total closing RAB value",                                 # Selecting and 
              Description %in% "Zone substations") %>%                                    # Filtering 
              select(rg_a_z_sub = Value),                                                 # variable 9

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "4(vii): Disclosure by Asset Category",                        #
              Subcategory %in% "Total closing RAB value",                                 # Selecting and 
              Description %in% "Total") %>%                                               # Filtering 
              select(rg_a_rab_clo = Value)) %>%                                           # variable 10

# Plotting the table
kable( align = "c",                                                 # Align the table and content to center 
       caption = "<h4>Closing Year RAB Segmentation</h4>",          # Table Title
       digits = 2,                                                  # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                        # 1. 
                     "Overhead",                    # 2.
                     "Underground",                 # 3. 
                     "Substation and Transformes",  # 4.
                     "Switchgear",                  # 5.
                     "Lines",                       # 6.
                     "Cables",                      # 7.
                     "Non Network",                 # 8.
                     "Other",                       # 9.
                     "Zone Substation",             # 10.
                     "Total")) %>%                  # 11.

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",    # Rows alterning color
                                          "hover")) %>%  # Responsive on mouse

              # Nest columns' header
              add_header_above(c(" " = 1,
                                 "Distribution and LV" = 4,
                                 "Subtransmission" = 2,
                                 "Network Assets" = 2,
                                 " " = 1,
                                 " " = 1))
```


## 2.8. Capital Expenditure

Capital expenditure = Assets commissioned
 + (Works under construction current disclosure year) - (Works under construction preceding disclosure year) - Adjustment resulting from asset allocation

### 2.8.1. Reliability, safety and environment

```{r,echo=FALSE}
## RAB Adjustment Table
bind_cols(    db_raw %>%                                                                  #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(i): Expenditure on Assets",                                #
              Subcategory %in% "Reliability, safety and environment",                     # Selecting and 
              Description %in% "Quality of supply") %>%                                   # Filtering 
              select(Year,rg_r_exp_qual = Value),                                         # variable 1 and 2

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(i): Expenditure on Assets",                                #
              Subcategory %in% "Reliability, safety and environment",                     # Selecting and 
              Description %in% "Legislative and regulatory") %>%                          # Filtering 
              select(rg_r_exp_leg_reg = Value),                                           # variable 3
       
db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(i): Expenditure on Assets",                                #
              Subcategory %in% "Reliability, safety and environment",                     # Selecting and 
              Description %in% "Other reliability, safety and environment") %>%           # Filtering 
              select(rg_r_exp_oth = Value),                                               # Variable 4

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(i): Expenditure on Assets",                                #
              Subcategory %in% "Reliability, safety and environment",                     # Selecting and 
              Description %in% "Total reliability, safety and environment") %>%           # Filtering 
              select(rg_r_exp_rel_tot = Value)) %>%                                       # Variable 5
       
# Plotting the table
kable( align = "c",                                               # Align the table and content to center 
       caption = "<h4>Reliability, safety and environment</h4>",  # Table Title
       digits = 2,                                                # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                                              # 1.
                     "Quality of supply",                                 # 2.
                     "Legislative and regulatory",                        # 3. Header Renaming
                     "Other reliability, safety and environment",         # 4. 
                     "Total reliability, safety and environment")) %>%    # 5. 

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                          "hover"))       # Responsive on mouse
```

#### 2.8.1.1. Quality of Supply

```{r,echo=FALSE}
## Asset Relocations Segmentation Table
bind_cols(db_raw %>%                                                                      #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(vi): Quality of Supply",                                    # Selecting and
              Subcategory %in% "Quality of supply less capital contributions",        # Filtering 
              Description %in% "Quality of supply less capital contributions") %>%            #
              select(Year,                                                                # Variable 1 and 2
                     rg_r_exp_rel_tot = Value),                                           #

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(vi): Quality of Supply",                                # Selecting and
              Subcategory %in% "Quality of supply less capital contributions",
              Description %in% "Capital contributions funding quality of supply") %>%                      # Filtering 
              select(rg_r_exp_rel_tot = Value),                                           # Variable 3

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(vi): Quality of Supply",                                # Selecting and
              Subcategory %in% "Quality of supply expenditure",
              Description %in% "Quality of supply expenditure") %>%                              # Filtering 
              select(rg_r_exp_rel_tot = Value)) %>%                                           # Variable 4

# Plotting the table
kable( align = "c",                                               # Align the table and content to center 
       caption = "<h4>Quality of Supply</h4>",  # Table Title
       digits = 2,                                                # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                                 # 1.
                     "Quality of supply less capital contributions",                    # 2.
                     "Capital contributions funding asset relocations",       # 3. Header Renaming
                     "Quality of supply expenditure")) %>%           # 4. 

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                          "hover"))       # Responsive on mouse
```

#### 2.8.1.2. Legislative and Regulatory

Nothing

#### 2.8.1.3. Other reliability, safety and environment

```{r,echo=FALSE}
## Asset Relocations Segmentation Table
bind_cols(db_raw %>%                                                                      #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(viii): Other Reliability, Safety and Environment",         # Selecting and
              Subcategory %in% "Other reliability, safety and environment less capital contributions",        # Filtering 
              Description %in% "Other reliability, safety and environment less capital contributions") %>%            #
              select(Year,                                                                # Variable 1 and 2
                     rg_r_exp_rel_tot = Value),                                           #

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(viii): Other Reliability, Safety and Environment",                                # Selecting and
              Subcategory %in% "Other reliability, safety and environment less capital contributions",
              Description %in% "Capital contributions funding other reliability, safety and environment") %>%                      # Filtering 
              select(rg_r_exp_rel_tot = Value),                                           # Variable 3

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(viii): Other Reliability, Safety and Environment",                                # Selecting and
              Subcategory %in% "Other reliability, safety and environment expenditure",
              Description %in% "Other reliability, safety and environment expenditure") %>%                              # Filtering 
              select(rg_r_exp_rel_tot = Value)) %>%                                           # Variable 4

# Plotting the table
kable( align = "c",                                               # Align the table and content to center 
       caption = "<h4>Quality of Supply</h4>",  # Table Title
       digits = 2,                                                # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                                 # 1.
                     "Other reliability, safety and environment less capital contributions",                    # 2.
                     "Capital contributions funding other reliability, safety and environment",       # 3. Header Renaming
                     "Other reliability, safety and environment expenditure")) %>%           # 4. 

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                          "hover"))       # Responsive on mouse
```

### 2.8.2. Expenditure on Network Assets

```{r,echo=FALSE}
## Capital Expenditure Segmentation Table
bind_cols(db_raw %>%                                                                      #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(i): Expenditure on Assets",                                #
              Subcategory %in% "Reliability, safety and environment",                     # Selecting and 
              Description %in% "Total reliability, safety and environment") %>%           # Filtering 
              select(Year,                                                                # Variable 1 and 2
                     rg_r_exp_rel_tot = Value),                                           #

db_raw %>%                                                                                # Selecting and
       filter(EDB %in% "Aurora Energy",                                                   # Filtering
              Section %in% "6a(i): Expenditure on Assets",                                # Variable 3
              Subcategory %in% "Consumer connection") %>%                                 # 
              select(rg_r_exp_cons_con = Value),
 
db_raw %>%                                                                                # Selecting and
       filter(EDB %in% "Aurora Energy",                                                   # Filtering
              Section %in% "6a(i): Expenditure on Assets",                                # Variable 4
              Subcategory %in% "System growth") %>%                                       # 
              select(rg_r_exp_sys_gro = Value),     
       
db_raw %>%                                                                                # Selecting and
       filter(EDB %in% "Aurora Energy",                                                   # Filtering
              Section %in% "6a(i): Expenditure on Assets",                                # Variable 5
              Subcategory %in% "Asset replacement and renewal") %>%                       # 
              select(rg_r_exp_rep_ren = Value), 

db_raw %>%                                                                                # Selecting and
       filter(EDB %in% "Aurora Energy",                                                   # Filtering
              Section %in% "6a(i): Expenditure on Assets",                                # Variable 6
              Subcategory %in% "Asset relocations") %>%                                   # 
              select(rg_r_exp_a_relo = Value)) %>%
       
       mutate(tot = rg_r_exp_rel_tot + rg_r_exp_cons_con + rg_r_exp_sys_gro + rg_r_exp_rep_ren + rg_r_exp_a_relo) %>%
       
# Plotting the table
kable( align = "c",                                               # Align the table and content to center 
       caption = "<h4>Expenditure on assets</h4>",  # Table Title
       digits = 2,                                                # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                                          # 1.
                     "Total reliability, safety and environment",     # 2.
                     "Consumer connection",                           # 3. Header Renaming
                     "System growth",                                 # 4. 
                     "Asset replacement and renewal",                 # 5.
                     "Asset relocations",                             # 6.
                     "Expenditure on assets")) %>%                    # 7. 

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                          "hover"))       # Responsive on mouse
```

```{r,graph-2-8-2,echo=FALSE}
# Capital Expenditure Bar plot
db_raw %>%                                                          #
       filter(EDB %in% "Aurora Energy",                             # Filtering
              Section %in% "6a(i): Expenditure on Assets",          #
              Category %in% "Network assets",                       #
              !Description %in% c("Total reliability, safety and environment",
                                   "Network assets",
                                   "Legislative and regulatory") )%>%   # Excluding Total

              mutate(Value = Value/1000) %>%   # Converting to Millions
       
                     select(Year,
                            Description,
                            Value) %>%
                     
                            # Plotting
                            ggplot(aes(x = Year,   # X Axis as Year
                                   y = Value,      # Y Axis $
                                   fill = Description)) +
                            # Bar Plot
                            geom_bar(stat = "identity") + 
                            labs(x = "[Years]",
                                 y = "[Millions $]",
                                 title = "Expenditure on Assets")
```

```{r,echo=FALSE}

db_raw %>%                                                          #
       filter(EDB %in% "Aurora Energy",                             # Filtering
              Section %in% "6a(i): Expenditure on Assets",          #
              Category %in% "Network assets",                       #
              !Description %in% c("Total reliability, safety and environment",
                                  "Network assets",
                                   "Legislative and regulatory") ) %>%   # Excluding Total

              mutate(Value = Value/1000) %>%   # Converting to Millions
       
                     select(Year,
                            Description,
                            Value) %>%
       
                            # Plotting the graph
                            ggplot(aes(x = Year,         # Independent varialble
                                       y = Value)) +     # Dependet variable 
              
                                   # Defining the graph's style
                                   geom_bar(position = "fill",   # Side by side bars
                                          stat = "identity",     # Deafult setting
                                          aes(fill = Description))+  # Fill the bars with the Network percentage

                                   labs(x="[years]",  # X axis label
                                        y="[%]",     # Y axis label
                                        title="Expenditure on Assets") # Graph title
```

#### 2.8.2.1. Consumer Connections

>consumer connection capex means capex where the primary driver is the establishment of a new consumer connection point, or alterations to an existing consumer connection point. This includes expenditure relating to- 


```{r,echo=FALSE}
## Consumer Connections
bind_cols(    db_raw %>%                                                                              #
       filter(EDB %in% "Aurora Energy",                                                               #
              Section %in% "6a(iii): Consumer Connection",                                            # Selecting and
              Description %in% "Capital contributions funding consumer connection expenditure") %>%   # Filtering 
              select(Year,rg_r_exp_qual = Value),                                                     # variable 1 and 2

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(iii): Consumer Connection",                                # Selecting and
              Description %in% "Consumer connection less capital contributions") %>%      # Filtering 
              select(rg_r_exp_leg_reg = Value),                                           # variable 3
       
db_raw %>%                                                                                 #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(iii): Consumer Connection",                                # Selecting and
              Description %in% "Consumer connection expenditure") %>%                     # Filtering 
              select(rg_r_exp_leg_reg = Value)) %>%                                       # variable 4
       
# Plotting the table
kable( align = "c",                                               # Align the table and content to center 
       caption = "<h4>Consumer connection expenditure</h4>",  # Table Title
       digits = 2,                                                # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                                              # 1.
                     "Capital contributions funding consumer connection expenditure",                                 # 2.
                     "Consumer connection less capital contributions",                        # 3. Header Renaming
                     "Consumer connection expenditure")) %>%    # 5. 

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                          "hover"))       # Responsive on mouse
```

```{r,graph-2-8-2-1,echo=FALSE}
# Capital Expenditure Bar plot
db_raw %>%                                                          #
       filter(EDB %in% "Aurora Energy",                             # Filtering
              Section %in% "6a(iii): Consumer Connection",          #
              Description %in% c("Capital contributions funding consumer connection expenditure",
                                   "Consumer connection less capital contributions") )%>%   # Excluding Total

              mutate(Value = Value/1000) %>%   # Converting to Millions
       
                     select(Year,
                            Description,
                            Value) %>%
                     
                            # Plotting
                            ggplot(aes(x = Year,   # X Axis as Year
                                   y = Value,      # Y Axis $
                                   fill = Description)) +
                            # Bar Plot
                            geom_bar(stat = "identity") + 
                            labs(x = "[Years]",
                                 y = "[Millions $]",
                                 title = "Consumer Connections Expenditure") +
                            theme(legend.position = "bottom")
```

#### 2.8.2.2. System Growth

```{r,echo=FALSE}

db_raw %>%                                                                             #
       filter(EDB %in% "Aurora Energy",                                                #
              Section %in% "6a(iv): System Growth and Asset Replacement and Renewal",  # Selecting and
              Subcategory %in% "System Growth",
              Year %in% "2018",
              !Description %in% c("System growth less capital contributions",
                                  "Capital contributions funding system growth")) %>%   # Filtering 
              select(Description) -> list


for (i in 1:nrow(list))
       {
       
       if (i == 1)
              {
              db_raw %>%                                                                             #
                     filter(EDB %in% "Aurora Energy",                                                #
                            Section %in% "6a(iv): System Growth and Asset Replacement and Renewal",  # Selecting and
                            Subcategory %in% "System Growth",
                            Description %in% list[i,]) %>%   # Filtering 
                                   select(Year,
                                          Value) -> temp
              }

       else
              {
              bind_cols(temp,
                        
                            db_raw %>%                                                                             #
                            filter(EDB %in% "Aurora Energy",                                                #
                                   Section %in% "6a(iv): System Growth and Asset Replacement and Renewal",  # Selecting and
                                   Subcategory %in% "System Growth",
                                   Description %in% list[i,]) %>%   # Filtering 
                                   select(Value)) -> temp
              }
       }

colnames(temp) <- c("Year",list$Description)

# Plotting the table
kable( temp,
       align = "c",                                               # Align the table and content to center 
       caption = "<h4>System Growth</h4>",  # Table Title
       digits = 2,                                                # Round the number
       format.args = list(big.mark=",")) %>%                            # Thousand mark

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                          "hover"))       # Responsive on mouse
rm(temp);rm(list)
```

```{r,graph-2-8-2-2,echo=FALSE}
# Capital Expenditure Bar plot
db_raw %>%                                                                             #
       filter(EDB %in% "Aurora Energy",                                                #
              Section %in% "6a(iv): System Growth and Asset Replacement and Renewal",  # Selecting and
              Subcategory %in% "System Growth",
              !Description %in% c("System growth less capital contributions",
                                  "Capital contributions funding system growth",
                                  "System growth expenditure"))%>%   # Excluding Total
              select(EDB,Year,Description,Value) %>%

              mutate(Value = Value/1000) %>%   # Converting to Millions
       
                     select(Year,
                            Description,
                            Value) %>%
                     
                            # Plotting
                            ggplot(aes(x = Year,   # X Axis as Year
                                   y = Value,      # Y Axis $
                                   fill = Description)) +
                            # Bar Plot
                            geom_bar(stat = "identity") + 
                            labs(x = "[Years]",
                                 y = "[Millions $]",
                                 title = "System Growth")
```

#### 2.8.2.3. Asset Replacement and Renewal

```{r,echo=FALSE}

db_raw %>%                                                                             #
       filter(EDB %in% "Aurora Energy",                                                #
              Section %in% "6a(iv): System Growth and Asset Replacement and Renewal",  # Selecting and
              Subcategory %in% "Asset Replacement and Renewal",
              Year %in% "2018",
              !Description %in% c("Capital contributions funding asset replacement and renewal",
                                  "Asset replacement and renewal less capital contributions")) %>%   # Filtering 
              select(Description) -> list


for (i in 1:nrow(list))
       {
       
       if (i == 1)
              {
              db_raw %>%                                                                             #
                     filter(EDB %in% "Aurora Energy",                                                #
                            Section %in% "6a(iv): System Growth and Asset Replacement and Renewal",  # Selecting and
                            Subcategory %in% "Asset Replacement and Renewal",
                            Description %in% list[i,]) %>%   # Filtering 
                                   select(Year,
                                          Value) -> temp
              }

       else
              {
              bind_cols(temp,
                        
                            db_raw %>%                                                                             #
                            filter(EDB %in% "Aurora Energy",                                                #
                                   Section %in% "6a(iv): System Growth and Asset Replacement and Renewal",  # Selecting and
                                   Subcategory %in% "Asset Replacement and Renewal",
                                   Description %in% list[i,]) %>%   # Filtering 
                                   select(Value)) -> temp
              }
       }

colnames(temp) <- c("Year",list$Description)

# Plotting the table
kable( temp,
       align = "c",                                               # Align the table and content to center 
       caption = "<h4>Asset Replacement and Renewal</h4>",  # Table Title
       digits = 2,                                                # Round the number
       format.args = list(big.mark=",")) %>%                            # Thousand mark

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                          "hover"))       # Responsive on mouse
rm(temp);rm(list)
```

```{r,graph-2-8-2-3,echo=FALSE}
# Capital Expenditure Bar plot
db_raw %>%                                                                             #
       filter(EDB %in% "Aurora Energy",                                                #
              Section %in% "6a(iv): System Growth and Asset Replacement and Renewal",  # Selecting and
              Subcategory %in% "Asset Replacement and Renewal",
              !Description %in% c("System growth less capital contributions",
                                  "Capital contributions funding system growth",
                                  "Asset replacement and renewal expenditure",
                                  "Asset replacement and renewal less capital contributions"))%>%   # Excluding Total
              select(EDB,Year,Description,Value) %>%

              mutate(Value = Value/1000) %>%   # Converting to Millions
       
                     select(Year,
                            Description,
                            Value) %>%
                     
                            # Plotting
                            ggplot(aes(x = Year,   # X Axis as Year
                                   y = Value,      # Y Axis $
                                   fill = Description)) +
                            # Bar Plot
                            geom_bar(stat = "identity") + 
                            labs(x = "[Years]",
                                 y = "[Millions $]",
                                 title = "Asset Replacement and Renewal")
```

### 2.8.3. Capital Expenditure

```{r,echo=FALSE}
## Capital Expenditure Segmentation Table
bind_cols(db_raw %>%                                                                      #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(i): Expenditure on Assets",                                # Selecting and
              Description %in% "Cost of financing") %>%                                   # Filtering 
              select(Year,                                                                # Variable 1 and 2
                     rg_r_exp_rel_tot = Value),                                           #

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(i): Expenditure on Assets",                                # Selecting and
              Description %in% "Value of capital contributions") %>%                      # Filtering 
              select(rg_r_exp_rel_tot = Value),                                           # Variable 3

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(i): Expenditure on Assets",                                # Selecting and
              Description %in% "Value of vested assets") %>%                              # Filtering 
              select(rg_r_exp_rel_tot = Value),                                           # Variable 4

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(i): Expenditure on Assets",                                # Selecting and
              Description %in% "Capital expenditure") %>%                                 # Filtering
              select(rg_r_exp_rel_tot = Value),                                           # Variable 5

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(i): Expenditure on Assets",                                # Selecting and
              Category %in% "Expenditure on assets",                                      # Filtering
              Description %in% "Expenditure on assets") %>%                               # Variable 6
              select(rg_r_exp_rel_tot = Value)) %>%                                       #

# Plotting the table
kable( align = "c",                                               # Align the table and content to center 
       caption = "<h4>Capital expenditure</h4>",  # Table Title
       digits = 2,                                                # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                                          # 1.
                     "Cost of financing",     # 2.
                     "Value of capital contributions",                           # 3. Header Renaming
                     "Value of vested assets",                                 # 4. 
                     "Capital expenditure",                 # 5.
                     "Expenditure on assets")) %>%                    # 6. 

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                          "hover"))       # Responsive on mouse
```

```{r,graph-2-8-3,echo=FALSE}
# Capital Expenditure Bar plot
bind_rows(db_raw %>%                                                                      #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(i): Expenditure on Assets",                                # Selecting and
              Description %in% "Cost of financing") %>%                                   # Filtering 
              select(Year,
                     Description, # Variable 1 and 2
                     Value),                                           #

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(i): Expenditure on Assets",                                # Selecting and
              Description %in% "Value of capital contributions") %>%                      # Filtering 
              select(Year,
                     Description,
                     Value),                                           # Variable 3

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(i): Expenditure on Assets",                                # Selecting and
              Description %in% "Value of vested assets") %>%                              # Filtering 
              select(Year,
                     Description,
                     Value),                                           # Variable 4

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(i): Expenditure on Assets",                                # Selecting and
              Description %in% "Capital expenditure") %>%                                 # Filtering
              select(Year,
                     Description,
                     Value)) %>% 
                     
       filter(!Value %in% 0) %>%
              
              mutate(Value = Value/1000) %>%
       
       
                            # Plotting
                            ggplot(aes(x = Year,   # X Axis as Year
                                   y = Value,      # Y Axis $
                                   fill = Description)) +
                            # Bar Plot
                            geom_bar(stat = "identity") + 
                            labs(x = "[Years]",
                                 y = "[Millions $]",
                                 title = "Asset Replacement and Renewal")
```

### 2.8.4. Asset Relocations

```{r,echo=FALSE}
## Asset Relocations Segmentation Table
bind_cols(db_raw %>%                                                                      #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(v): Asset Relocations",                                    # Selecting and
              Subcategory %in% "Asset relocations less capital contributions",        # Filtering 
              Description %in% "Asset relocations less capital contributions") %>%            #
              select(Year,                                                                # Variable 1 and 2
                     rg_r_exp_rel_tot = Value),                                           #

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(v): Asset Relocations",                                # Selecting and
              Subcategory %in% "Asset relocations less capital contributions",
              Description %in% "Capital contributions funding asset relocations") %>%                      # Filtering 
              select(rg_r_exp_rel_tot = Value),                                           # Variable 3

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(v): Asset Relocations",                                # Selecting and
              Subcategory %in% "Asset relocations expenditure",
              Description %in% "Asset relocations expenditure") %>%                              # Filtering 
              select(rg_r_exp_rel_tot = Value)) %>%                                           # Variable 4

# Plotting the table
kable( align = "c",                                               # Align the table and content to center 
       caption = "<h4>Asset relocations expenditure</h4>",  # Table Title
       digits = 2,                                                # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                                 # 1.
                     "Asset relocations less capital contributions",                    # 2.
                     "Capital contributions funding asset relocations",       # 3. Header Renaming
                     "Asset relocations expenditure")) %>%           # 4. 

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                          "hover"))       # Responsive on mouse
```

```{r,graph-2-8-4,echo=FALSE}
# Capital Expenditure Bar plot
db_raw %>%                                                                             #
       filter(EDB %in% "Aurora Energy",                                                #
              Section %in% "6a(v): Asset Relocations",  # Selecting and
              Subcategory %in% "Asset relocations less capital contributions")%>%   # Excluding Total
              select(Year,Description,Value) %>%

              mutate(Value = Value/1000) %>%   # Converting to Millions
       
                     select(Year,
                            Description,
                            Value) %>%
                     
                            # Plotting
                            ggplot(aes(x = Year,   # X Axis as Year
                                   y = Value,      # Y Axis $
                                   fill = Description)) +
                            # Bar Plot
                            geom_bar(stat = "identity") + 
                            labs(x = "[Years]",
                                 y = "[Millions $]",
                                 title = "Asset Relocations")
```

```{r,echo=FALSE}

db_raw %>%                                                                             #
       filter(EDB %in% "Aurora Energy",                                                #
              Section %in% "6a(v): Asset Relocations",  # Selecting and
              Subcategory %in% "Asset relocations less capital contributions")%>%   # Excluding Total
              select(Year,Description,Value) %>%

              mutate(Value = Value/1000) %>%   # Converting to Millions
       
                     select(Year,
                            Description,
                            Value) %>%
       
                            # Plotting the graph
                            ggplot(aes(x = Year,         # Independent varialble
                                       y = Value)) +     # Dependet variable 
              
                                   # Defining the graph's style
                                   geom_bar(position = "fill",   # Side by side bars
                                          stat = "identity",     # Deafult setting
                                          aes(fill = Description))+  # Fill the bars with the Network percentage

                                   labs(x="[years]",  # X axis label
                                        y="[%]",     # Y axis label
                                        title="Asset Relocations") # Graph title
```

### 2.8.5. Operational Expenditure

```{r,echo=FALSE}
## Asset Relocations Segmentation Table
bind_cols(db_raw %>%                                                                      #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6b(i): Operational Expenditure",                                    # Selecting and
              Category %in% "Network opex",        # Filtering 
              Description %in% "Network opex") %>%            #
              select(Year,                                                                # Variable 1 and 2
                     rg_r_exp_rel_tot = Value),                                           #

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6b(i): Operational Expenditure",                                # Selecting and
              Category %in% "Non-network opex",
              Description %in% "Non-network opex") %>%                      # Filtering 
              select(rg_r_exp_rel_tot = Value),                                           # Variable 3

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6b(i): Operational Expenditure",                                # Selecting and
              Category %in% "Operational expenditure",
              Description %in% "Operational expenditure") %>%                              # Filtering 
              select(rg_r_exp_rel_tot = Value)) %>%                                           # Variable 4

# Plotting the table
kable( align = "c",                                               # Align the table and content to center 
       caption = "<h4>Operational expenditure</h4>",  # Table Title
       digits = 2,                                                # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                                 # 1.
                     "Network opex",                    # 2.
                     "Non-network opex",       # 3. Header Renaming
                     "Operational expenditure")) %>%           # 4. 

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                          "hover"))       # Responsive on mouse
```

## 2.9. Capital Contribution

Accordlying with the @IM2018 This is money received from consumers or other parties to share the costs to enhance the network.

```{r,echo=FALSE}
## Capital Contribution
bind_cols(db_raw %>%                                                                              #
       filter(EDB %in% "Aurora Energy",                                                               #
              Section %in% "6a(iii): Consumer Connection",                                            # Selecting and
              Subcategory %in% "Consumer connection less capital contributions",
              Description %in% "Capital contributions funding consumer connection expenditure") %>%   # Filtering 
              select(Year,rg_cap_con_1 = Value),                                                     # variable 1 and 2

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(iv): System Growth and Asset Replacement and Renewal",     # Selecting and
              Subcategory %in% "Asset Replacement and Renewal",
              Description %in% "Capital contributions funding asset replacement and renewal") %>%      # Filtering 
              select(rg_cap_con_2 = Value),                                           # variable 3

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(iv): System Growth and Asset Replacement and Renewal",     # Selecting and
              Subcategory %in% "System Growth",
              Description %in% "Capital contributions funding system growth") %>%      # Filtering 
              select(rg_cap_con_3 = Value),                                           # variable 4

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(v): Asset Relocations",     # Selecting and
              Subcategory %in% "Asset relocations less capital contributions",
              Description %in% "Capital contributions funding asset relocations") %>%      # Filtering 
              select(rg_cap_con_4 = Value),                                           # variable 5

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(vi): Quality of Supply",     # Selecting and
              Subcategory %in% "Quality of supply less capital contributions",
              Description %in% "Capital contributions funding quality of supply") %>%      # Filtering 
              select(rg_cap_con_5 = Value),                                           # variable 6

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(vii): Legislative and Regulatory",     # Selecting and
              Subcategory %in% "Legislative and regulatory less capital contributions",
              Description %in% "Capital contributions funding legislative and regulatory") %>%      # Filtering 
              select(rg_cap_con_6 = Value),                                           # variable 7

db_raw %>%                                                                                #
       filter(EDB %in% "Aurora Energy",                                                   #
              Section %in% "6a(viii): Other Reliability, Safety and Environment",     # Selecting and
              Subcategory %in% "Other reliability, safety and environment less capital contributions",
              Description %in% "Capital contributions funding other reliability, safety and environment") %>%      # Filtering 
              select(rg_cap_con_7 = Value)) %>%                                         # variable 8
                     
                     mutate(rg_cap_con_1+rg_cap_con_2+rg_cap_con_3+rg_cap_con_4+rg_cap_con_5+rg_cap_con_6+rg_cap_con_7) %>%
       
# Plotting the table
kable( align = "c",                                               # Align the table and content to center 
       caption = "<h4>Capital Contribution</h4>",  # Table Title
       digits = 2,                                                # Round the number
       format.args = list(big.mark=","),                            # Thousand mark
       col.names = c("Year",                                                                   # 1.
                     "consumer connection expenditure",          # 2.
                     "asset replacement and renewal",                         # 3. Header Renaming
                     "system growth", # 4.
                     "asset relocations", # 5.
                     "quality of supply", # 6.
                     "legislative and regulatory", # 7.
                     "other reliability, safety and environment", # 8.
                     "Capital Contribution")) %>%                                   # 9. 

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                          "hover"))       # Responsive on mouse
```

## 2.10. Revenue

```{r,echo=FALSE}
## Asset Relocations Segmentation Table
bind_cols(db_raw %>%    filter(EDB %in% "Aurora Energy",
                     Section %in% "7(i): Revenue",
                     Subcategory %in% "Actual") %>%
                     select(Year,
                            "Line charge revenue" = Value),

db_raw %>%    filter(EDB %in% "Aurora Energy",
                     Section %in% "7(i): Revenue",
                     Subcategory %in% "Target") %>%
                     select(Target = Value)) %>%

# Plotting the table
kable( align = "c",                                               # Align the table and content to center 
       caption = "<h4>Revenue</h4>",  # Table Title
       digits = 0,                                                # Round the number
       format.args = list(big.mark=",")) %>%                            # Thousand mark

       # Adding style to look nice
       kable_styling(bootstrap_options = c("striped",     # Rows alterning color
                                          "hover"))       # Responsive on mouse
```

```{r echo=FALSE}
## Graph network comparing
db_raw %>%    filter(EDB %in% "Aurora Energy",
                     Section %in% "7(i): Revenue",
                     Subcategory %in% c("Actual",
                                       "Target")) %>%
                     select(Year,
                            Subcategory,
                            Value) %>%

                            ggplot(aes(x = Year,
                                       y = Value,
                                       fill = Subcategory)) + 
                                   geom_bar(position = position_dodge(),
                                            stat = "identity") +
                                   scale_fill_brewer(palette = "Paired") +
                                   labs(x = "[Year]",
                                        y = "[km]",
                                        title = "Line charge revenue")
```




# 3. Aurora Energy Analysis



# 4. Benchmarking

The documents is very straigthforward, initialy I will describe all the Aurora Energy Network, and later I will compare with the other Lines Companies. I also will apply the K-means cluster method to compare in group.



```{r,echo=FALSE}

teste <- db_neat %>% filter(Network %in% "All") %>% select(a_li)



```

## 4.1. Clusterization

```{r,echo=FALSE}


teste <- db_neat %>% filter(Network %in% "All") %>% select(EDB,Network,a_li,a_li_ur,a_li_oh)

teste2 <- kmeans(x = teste[,3:5],centers = 5)


teste2 <- bind_cols(as_tibble(teste),C = teste2$cluster)

```

# 5. Results




# 6. Conclusions
[@Uekita2017]

# 7. References